# deep_identity_app.py
# Deep Identity ‚Äî –µ–¥–∏–Ω—ã–π app (–ö–ª–∏–µ–Ω—Ç + –ú–∞—Å—Ç–µ—Ä)
# 3 –±–ª–æ–∫–∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏, 1 –≤–æ–ø—Ä–æ—Å = 1 —ç–∫—Ä–∞–Ω, –≤–∞—Ä–∏–∞–Ω—Ç—ã + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥ –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º
# –ú–∞—Å—Ç–µ—Ä-—Ä–µ–∂–∏–º –ø–æ –ø–∞—Ä–æ–ª—é, –æ—Ç—á—ë—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∏ –Ω–µ –≤–∏–¥–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
#
# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
# - streamlit
# - openai (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –±–µ–∑ –æ—Ç—á—ë—Ç–∞)
#
# Secrets (Streamlit Cloud ‚Üí App settings ‚Üí Secrets):
# OPENAI_API_KEY="sk-..."
# MASTER_PASSWORD="your_password"
# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) OPENAI_MODEL="gpt-5.1"

import os
import json
import uuid
import itertools
from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any, Tuple
from datetime import datetime

import streamlit as st

# --- OpenAI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ---
try:
    from openai import OpenAI
except Exception:
    OpenAI = None  # type: ignore


# ============================
# –§–∞–π–ª—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è
# ============================

RESULTS_FILE = "deep_identity_results.json"


def _now_iso() -> str:
    return datetime.now().isoformat(timespec="seconds")


def ensure_results_file():
    if not os.path.exists(RESULTS_FILE):
        with open(RESULTS_FILE, "w", encoding="utf-8") as f:
            json.dump([], f, ensure_ascii=False, indent=2)


def load_results() -> List[Dict[str, Any]]:
    ensure_results_file()
    try:
        with open(RESULTS_FILE, "r", encoding="utf-8") as f:
            data = json.load(f)
        if isinstance(data, list):
            return data
        return []
    except Exception:
        return []


def append_result(item: Dict[str, Any]) -> None:
    ensure_results_file()
    data = load_results()
    data.append(item)
    with open(RESULTS_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)


def update_result(updated_item: Dict[str, Any]) -> None:
    ensure_results_file()
    data = load_results()
    rid = updated_item.get("id")
    out = []
    for x in data:
        if x.get("id") == rid:
            out.append(updated_item)
        else:
            out.append(x)
    with open(RESULTS_FILE, "w", encoding="utf-8") as f:
        json.dump(out, f, ensure_ascii=False, indent=2)


# ============================
# –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è
# ============================

POTENTIALS = [
    "AMETIST",   # –≥–ª—É–±–∏–Ω–∞/–∞–Ω–∞–ª–∏–∑/–º—ã—à–ª–µ–Ω–∏–µ
    "SAPFIR",    # —Å–º—ã—Å–ª/–º–∏—Å—Å–∏—è/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤–µ–∫—Ç–æ—Ä
    "GELIODOR",  # –≥–æ–ª–æ—Å/–Ω–µ—Ç–≤–æ—Ä–∫/–æ–±—É—á–µ–Ω–∏–µ/–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
    "GRANAT",    # —Å—Ü–µ–Ω–∞/—ç–º–æ—Ü–∏–∏/–≤–ª–∏—è–Ω–∏–µ/–≤–Ω–∏–º–∞–Ω–∏–µ
    "CITRIN",    # –¥–µ–Ω—å–≥–∏/—Å–¥–µ–ª–∫–∏/—Ä–µ–∑—É–ª—å—Ç–∞—Ç/–ø–æ–±–µ–¥–∞
    "IZUMRUD",   # –∫—Ä–∞—Å–æ—Ç–∞/—ç—Å—Ç–µ—Ç–∏–∫–∞/–∑–∞–±–æ—Ç–∞/–≥–∞—Ä–º–æ–Ω–∏—è
    "YANTAR",    # –ø–æ—Ä—è–¥–æ–∫/—Å–∏—Å—Ç–µ–º–∞/–∑–¥–æ—Ä–æ–≤—å–µ/–¥–µ—Ç–∞–ª–∏
    "RUBIN",     # –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫/–Ω–æ–≤–∏–∑–Ω–∞/–ø–æ–µ–∑–¥–∫–∏
    "SHUNGIT",   # —Ç–µ–ª–æ/—Å–∏–ª–∞/–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å/—Ñ–∏–∑-–æ–ø–æ—Ä–∞
]

POT_LABEL = {
    "AMETIST": "–ê–º–µ—Ç–∏—Å—Ç",
    "SAPFIR": "–°–∞–ø—Ñ–∏—Ä",
    "GELIODOR": "–ì–µ–ª–∏–æ–¥–æ—Ä",
    "GRANAT": "–ì—Ä–∞–Ω–∞—Ç",
    "CITRIN": "–¶–∏—Ç—Ä–∏–Ω",
    "IZUMRUD": "–ò–∑—É–º—Ä—É–¥",
    "YANTAR": "–Ø–Ω—Ç–∞—Ä—å",
    "RUBIN": "–†—É–±–∏–Ω",
    "SHUNGIT": "–®—É–Ω–≥–∏—Ç",
}

# –ö–æ—Ä–æ—Ç–∫–∏–µ —Å–º—ã—Å–ª—ã ‚Äî –¥–ª—è –æ—Ç—á—ë—Ç–∞/—Ç–∞–±–ª–∏—Ü—ã
POT_MEANING = {
    "AMETIST": "–ì–ª—É–±–∏–Ω–∞ –º—ã—à–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–∏–∑, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, ¬´–¥–æ–π—Ç–∏ –¥–æ —Å—É—Ç–∏¬ª.",
    "SAPFIR": "–°–º—ã—Å–ª, –º–∏—Å—Å–∏—è, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤–µ–∫—Ç–æ—Ä, ¬´–∑–∞—á–µ–º —è –∂–∏–≤—É/–¥–µ–ª–∞—é¬ª.",
    "GELIODOR": "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–±—É—á–µ–Ω–∏–µ, –Ω–µ—Ç–≤–æ—Ä–∫, –≥–æ–ª–æ—Å, –æ–±—ä—è—Å–Ω—è—Ç—å –∏ —Å–æ–µ–¥–∏–Ω—è—Ç—å –ª—é–¥–µ–π.",
    "GRANAT": "–≠–º–æ—Ü–∏–∏, –≤–ª–∏—è–Ω–∏–µ, —Å—Ü–µ–Ω–∞/–≤–∏–¥–∏–º–æ—Å—Ç—å, —Ö–∞—Ä–∏–∑–º–∞ –∏ –≤–Ω–∏–º–∞–Ω–∏–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏.",
    "CITRIN": "–î–µ–Ω—å–≥–∏, —Å–¥–µ–ª–∫–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–±–µ–¥—ã, –ø—Ä–æ–¥—É–∫—Ç/–±–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç.",
    "IZUMRUD": "–≠—Å—Ç–µ—Ç–∏–∫–∞, –∫—Ä–∞—Å–æ—Ç–∞, –∑–∞–±–æ—Ç–∞, –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞, –≥–∞—Ä–º–æ–Ω–∏—è.",
    "YANTAR": "–ü–æ—Ä—è–¥–æ–∫, —Å–∏—Å—Ç–µ–º–∞, –¥–µ—Ç–∞–ª–∏, –∑–¥–æ—Ä–æ–≤—å–µ, ¬´—á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ¬ª.",
    "RUBIN": "–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫, –Ω–æ–≤–∏–∑–Ω–∞, –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞/–æ–ø—ã—Ç, —Å–æ–±—ã—Ç–∏—è.",
    "SHUNGIT": "–¢–µ–ª–æ, —Å–∏–ª–∞, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å, —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ø–æ—Ä–∞, –¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ —Ç–µ–ª–æ.",
}

# ============================
# OpenAI –∫–ª–∏–µ–Ω—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç—á—ë—Ç–∞)
# ============================

def get_openai_client() -> Optional[Any]:
    if OpenAI is None:
        return None
    api_key = None
    try:
        api_key = st.secrets.get("OPENAI_API_KEY", None)
    except Exception:
        api_key = None
    if not api_key:
        api_key = os.environ.get("OPENAI_API_KEY")

    if not api_key:
        return None
    return OpenAI(api_key=api_key)


def get_openai_model() -> str:
    try:
        m = st.secrets.get("OPENAI_MODEL", "")
        if m:
            return str(m)
    except Exception:
        pass
    return os.environ.get("OPENAI_MODEL", "gpt-5.1")


# ============================
# –û–±—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤
# ============================

@dataclass
class AnswerOption:
    text: str
    score_changes: Dict[str, float] = field(default_factory=dict)
    inject_questions: List[str] = field(default_factory=list)
    tags: List[str] = field(default_factory=list)  # –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è


@dataclass
class Question:
    id: str
    text: str
    block: int
    group: str = ""            # –¥–ª—è –±–ª–æ–∫–∞ 3: c1/c2/c3
    allow_multiple: bool = False
    allow_comment: bool = True
    options: List[AnswerOption] = field(default_factory=list)


# ============================
# –£–≥–ª—É–±–ª—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã ("–ø–æ—á–µ–º—É")
# ============================

MOTIVE_OPTIONS = [
    ("BODY_PROCESS", "–ü—Ä–æ—Ü–µ—Å—Å/–æ—â—É—â–µ–Ω–∏—è –≤ —Ç–µ–ª–µ (—É—Å—Ç–∞–ª–æ—Å—Ç—å, —ç–Ω–µ—Ä–≥–∏—è, —Ç–æ–Ω—É—Å)"),
    ("WIN_SPEED", "–ü–æ–±–µ–¥–∞/—Å–∫–æ—Ä–æ—Å—Ç—å/–±—ã—Ç—å –ø–µ—Ä–≤—ã–º (—Å—á—ë—Ç, —Ä–µ–π—Ç–∏–Ω–≥, —Ä–µ–∑—É–ª—å—Ç–∞—Ç)"),
    ("ADRENALINE_RESET", "–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫/–Ω–æ–≤–∏–∑–Ω–∞ (–¥–≤–∏–∂, –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞, —Å–æ–±—ã—Ç–∏—è)"),
    ("MONEY_VALUE", "–î–µ–Ω—å–≥–∏/—Ü–µ–Ω–Ω–æ—Å—Ç—å/–≤—ã–≥–æ–¥–∞ (–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è, —Å–¥–µ–ª–∫–∏, —Ü–∏—Ñ—Ä—ã)"),
    ("SYSTEM_ORDER", "–ü–æ—Ä—è–¥–æ–∫/–∫–æ–Ω—Ç—Ä–æ–ª—å/–ª–æ–≥–∏–∫–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –¥–µ—Ç–∞–ª–∏, ¬´—á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ¬ª)"),
    ("MEANING_MISSION", "–°–º—ã—Å–ª/–º–∏—Å—Å–∏—è/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤–µ–∫—Ç–æ—Ä (¬´–∑–∞—á–µ–º¬ª, –ø–æ–ª—å–∑–∞ –º–∏—Ä—É)"),
    ("PEOPLE_CONNECTION", "–õ—é–¥–∏/—Å–≤—è–∑–∏/–Ω–µ—Ç–≤–æ—Ä–∫ (—Å–æ–µ–¥–∏–Ω—è—Ç—å, –æ–±—â–∞—Ç—å—Å—è, –æ–±—É—á–∞—Ç—å)"),
    ("BEAUTY_HARMONY", "–ö—Ä–∞—Å–æ—Ç–∞/–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞/–≥–∞—Ä–º–æ–Ω–∏—è (—ç—Å—Ç–µ—Ç–∏–∫–∞, —É—é—Ç, —Å—Ç–∏–ª—å)"),
    ("IMPACT_EMOTION", "–í–ª–∏—è–Ω–∏–µ/—ç–º–æ—Ü–∏—è/–æ—Ç–∫–ª–∏–∫ –ª—é–¥–µ–π (—Ö–∞—Ä–∏–∑–º–∞, –≤–Ω–∏–º–∞–Ω–∏–µ, —Ä–µ–∞–∫—Ü–∏—è)"),
]

LACK_OPTIONS = [
    ("EMPTY", "–ü—É—Å—Ç–æ—Ç–∞/–∞–ø–∞—Ç–∏—è"),
    ("ANXIETY", "–¢—Ä–µ–≤–æ–≥–∞/–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ"),
    ("IRRITATION", "–†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ/–∑–ª–æ—Å—Ç—å"),
    ("MEANING_LOSS", "–ü–æ—Ç–µ—Ä—è —Å–º—ã—Å–ª–∞/¬´–∑–∞—á–µ–º –≤—Å—ë —ç—Ç–æ¬ª"),
    ("OK", "–ù–∏—á–µ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ, —è –Ω–æ—Ä–º"),
]

# –ú–∞–ø–ø–∏–Ω–≥ –º–æ—Ç–∏–≤–∞ ‚Üí –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—ã (–≤–∞–∂–Ω–æ: –†—É–±–∏–Ω –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Å–ø–æ—Ä—Ç–∞)
MOTIVE_TO_POT = {
    "BODY_PROCESS": {"SHUNGIT": 1.0},
    "WIN_SPEED": {"CITRIN": 1.0},
    "ADRENALINE_RESET": {"RUBIN": 1.0},
    "MONEY_VALUE": {"CITRIN": 1.0},
    "SYSTEM_ORDER": {"YANTAR": 1.0, "AMETIST": 0.3},
    "MEANING_MISSION": {"SAPFIR": 1.0, "AMETIST": 0.3},
    "PEOPLE_CONNECTION": {"GELIODOR": 1.0, "GRANAT": 0.2},
    "BEAUTY_HARMONY": {"IZUMRUD": 1.0, "GRANAT": 0.2},
    "IMPACT_EMOTION": {"GRANAT": 1.0, "GELIODOR": 0.3},
}

# –ï—Å–ª–∏ "–∫–æ–≥–¥–∞ —ç—Ç–æ–≥–æ –Ω–µ—Ç" ‚Üí —Å–∏–≥–Ω–∞–ª—ã —Ä–∞–Ω—ã/–¥–µ—Ñ–∏—Ü–∏—Ç–∞ (–º—è–≥–∫–æ)
LACK_TO_HINT = {
    "EMPTY": {"SAPFIR": 0.4, "RUBIN": 0.2},
    "ANXIETY": {"YANTAR": 0.4},
    "IRRITATION": {"CITRIN": 0.3, "GRANAT": 0.2},
    "MEANING_LOSS": {"SAPFIR": 0.6},
    "OK": {},
}


def apply_score(scores: Dict[str, float], changes: Dict[str, float]) -> None:
    for k, v in changes.items():
        scores[k] = float(scores.get(k, 0.0)) + float(v)


def render_deep_probe(qid: str, group_for_block3: Optional[str] = None) -> Dict[str, Any]:
    """
    –£–≥–ª—É–±–ª–µ–Ω–∏–µ: 2 –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–∞ + —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
    """
    st.markdown("#### üîé –£–≥–ª—É–±–ª–µ–Ω–∏–µ (30‚Äì60 —Å–µ–∫—É–Ω–¥)")
    st.caption("–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–µ: –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∏—á–∏—Ç—å ¬´—á—Ç–æ —è –¥–µ–ª–∞—é¬ª –æ—Ç ¬´–∑–∞—á–µ–º –º–Ω–µ —ç—Ç–æ –Ω–∞ –≥–ª—É–±–∏–Ω–µ¬ª.")

    m_key = st.radio(
        "–ü–æ—á–µ–º—É —ç—Ç–æ —Ç–µ–±—è —Ä–µ–∞–ª—å–Ω–æ —Ü–µ–ø–ª—è–µ—Ç? (–≤—ã–±–µ—Ä–∏ 1 –≥–ª–∞–≤–Ω—ã–π –º–æ—Ç–∏–≤)",
        options=[k for k, _ in MOTIVE_OPTIONS],
        format_func=lambda k: dict(MOTIVE_OPTIONS)[k],
        key=f"motive_{qid}",
    )
    l_key = st.radio(
        "–ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç –≤ –∂–∏–∑–Ω–∏, —á—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ?",
        options=[k for k, _ in LACK_OPTIONS],
        format_func=lambda k: dict(LACK_OPTIONS)[k],
        key=f"lack_{qid}",
    )
    txt = st.text_area(
        "–û–¥–∏–Ω –∂–∏–≤–æ–π –ø—Ä–∏–º–µ—Ä (–ø–æ –∂–µ–ª–∞–Ω–∏—é): —á—Ç–æ –∑–∞ —Å–∏—Ç—É–∞—Ü–∏—è/–∏—Å—Ç–æ—Ä–∏—è —Å—Ç–æ–∏—Ç –∑–∞ —Ç–≤–æ–∏–º –≤—ã–±–æ—Ä–æ–º?",
        key=f"deep_text_{qid}",
        height=90,
        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–∫–æ–≥–¥–∞ —è‚Ä¶ —è —á—É–≤—Å—Ç–≤—É—é‚Ä¶¬ª / ¬´—è –¥–µ–ª–∞—é —ç—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ‚Ä¶¬ª",
    )

    payload = {
        "motive": m_key,
        "lack": l_key,
        "deep_text": (txt or "").strip(),
    }
    if group_for_block3:
        payload["group"] = group_for_block3
    return payload


# ============================
# –ë–ª–æ–∫ 1 (–¥–µ—Ç—Å—Ç–≤–æ) ‚Äî —Å –≤–µ—Ç–≤–ª–µ–Ω–∏—è–º–∏
# ============================

def build_block1_questions() -> Dict[str, Question]:
    q: Dict[str, Question] = {}

    q["b1_q1_free_play"] = Question(
        id="b1_q1_free_play",
        block=1,
        text="–ö–∞–∫ —Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–≤–æ–¥–∏–ª(–∞) —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –≤ –¥–µ—Ç—Å—Ç–≤–µ (–ª–µ—Ç –¥–æ 10)?",
        allow_multiple=True,
        options=[
            AnswerOption("–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã –Ω–∞ —É–ª–∏—Ü–µ: –±–µ–≥, –¥–æ–≥–æ–Ω—è–ª–∫–∏, –ª–∞–∑–∞–Ω–∏–µ, —Å–ø–æ—Ä—Ç",
                         {"SHUNGIT": 2}, inject_questions=["b1_q7_sport_detail"], tags=["sport"]),
            AnswerOption("–ö–Ω–∏–≥–∏, –∫—Ä–æ—Å—Å–≤–æ—Ä–¥—ã, –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏ ‚Äî –ª—é–±–∏–ª(–∞) –¥—É–º–∞—Ç—å",
                         {"AMETIST": 2, "SAPFIR": 0.5}, inject_questions=["b1_q2_reading_detail"], tags=["thinking"]),
            AnswerOption("–ò–≥—Ä–∞ ¬´–º–∞–≥–∞–∑–∏–Ω¬ª, –ø—Ä–æ–¥–∞–∂–∏, –æ–±–º–µ–Ω—ã, —Ç–æ—Ä–≥",
                         {"CITRIN": 2}, inject_questions=["b1_q3_trading_detail"], tags=["money"]),
            AnswerOption("–ö–æ–Ω—Ü–µ—Ä—Ç—ã/—Å—Ü–µ–Ω–∫–∏/–≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è",
                         {"GRANAT": 2, "RUBIN": 0.5}, inject_questions=["b1_q4_stage_detail"], tags=["stage"]),
            AnswerOption("–ñ–∏–≤–æ—Ç–Ω—ã–µ: –∂–∞–ª–µ–ª(–∞), –ª–µ—á–∏–ª(–∞), –∫–æ—Ä–º–∏–ª(–∞)",
                         {"IZUMRUD": 2}, inject_questions=["b1_q5_animals_detail"], tags=["care"]),
            AnswerOption("–†–∞–∑–±–∏—Ä–∞—Ç—å/—Å–æ–±–∏—Ä–∞—Ç—å, –õ–µ–≥–æ, —Å—Ö–µ–º—ã",
                         {"YANTAR": 1, "AMETIST": 1}, inject_questions=["b1_q8_order_tech_detail"], tags=["system"]),
            AnswerOption("–ë–æ–ª—Ç–∞–ª(–∞), –æ–±—â–∞–ª—Å—è(–∞—Å—å), —à—É—Ç–∏–ª(–∞), –ø—Ä–∏–¥—É–º—ã–≤–∞–ª(–∞) –∏—Å—Ç–æ—Ä–∏–∏",
                         {"GELIODOR": 2}, inject_questions=["b1_q6_talk_detail"], tags=["network"]),
        ],
    )

    q["b1_q2_subjects"] = Question(
        id="b1_q2_subjects",
        block=1,
        text="–ö–∞–∫–∏–µ —à–∫–æ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Ç—ã –ª—é–±–∏–ª(–∞) –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        allow_multiple=True,
        options=[
            AnswerOption("–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞/—Ñ–∏–∑–∏–∫–∞/–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞/–ª–æ–≥–∏–∫–∞", {"AMETIST": 2, "YANTAR": 1}, tags=["thinking"]),
            AnswerOption("–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞/–∏—Å—Ç–æ—Ä–∏—è/—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è/–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è", {"SAPFIR": 2, "AMETIST": 1}, tags=["meaning"]),
            AnswerOption("–ú—É–∑—ã–∫–∞/–ø–µ–Ω–∏–µ/—Ç–µ–∞—Ç—Ä/–≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è", {"GRANAT": 1, "GELIODOR": 1}, inject_questions=["b1_q9_music_detail"], tags=["stage"]),
            AnswerOption("–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞/—Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è", {"SHUNGIT": 1, "CITRIN": 0.5}, inject_questions=["b1_q7_sport_detail"], tags=["sport"]),
            AnswerOption("–†–∏—Å–æ–≤–∞–Ω–∏–µ/–¥–∏–∑–∞–π–Ω/–∫—Ä–∞—Å–æ—Ç–∞", {"IZUMRUD": 2}, tags=["beauty"]),
            AnswerOption("–ù–∏—á–µ–≥–æ –æ—Å–æ–±–æ ‚Äî —É—á–∏–ª—Å—è(–∞—Å—å) ¬´–∫–∞–∫ –Ω–∞–¥–æ¬ª", {"YANTAR": 0.5}, tags=["system"]),
        ],
    )

    q["b1_q3_clubs"] = Question(
        id="b1_q3_clubs",
        block=1,
        text="–ù–∞ –∫–∞–∫–∏–µ –∫—Ä—É–∂–∫–∏/—Å–µ–∫—Ü–∏–∏ —Ç—ã —Ö–æ–¥–∏–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ?",
        allow_multiple=True,
        options=[
            AnswerOption("–°–ø–æ—Ä—Ç", {"SHUNGIT": 1, "CITRIN": 0.4}, inject_questions=["b1_q7_sport_detail"], tags=["sport"]),
            AnswerOption("–ú—É–∑—ã–∫–∞/–≤–æ–∫–∞–ª/—Ç–µ–∞—Ç—Ä/—Ç–∞–Ω—Ü—ã –∫–∞–∫ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è", {"GRANAT": 1, "GELIODOR": 1}, inject_questions=["b1_q4_stage_detail"], tags=["stage"]),
            AnswerOption("–¢–µ—Ö–Ω–∏–∫–∞/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ/—Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞", {"YANTAR": 2, "AMETIST": 1}, tags=["system"]),
            AnswerOption("–†–∏—Å–æ–≤–∞–Ω–∏–µ/–¥–∏–∑–∞–π–Ω/hand-made", {"IZUMRUD": 2}, tags=["beauty"]),
            AnswerOption("–õ–∏–¥–µ—Ä—Å—Ç–≤–æ/–æ–ª–∏–º–ø–∏–∞–¥—ã/—ç–∫–æ–Ω–æ–º–∏–∫–∞", {"CITRIN": 1.5, "RUBIN": 0.5}, tags=["money"]),
            AnswerOption("–ü–æ—á—Ç–∏ –Ω–∏–∫—É–¥–∞ / –ø–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", {"YANTAR": 0.5}, tags=["system"]),
        ],
    )

    q["b1_q4_choice"] = Question(
        id="b1_q4_choice",
        block=1,
        text="–ö—Ç–æ —á–∞—â–µ –≤—ã–±–∏—Ä–∞–ª, —á–µ–º —Ç—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è –≤ –¥–µ—Ç—Å—Ç–≤–µ (–∫—Ä—É–∂–∫–∏, —Å–µ–∫—Ü–∏–∏, –∑–∞–Ω—è—Ç–∏—è)?",
        allow_multiple=False,
        options=[
            AnswerOption("–Ø —Å–∞–º(–∞) —Ä–µ—à–∞–ª(–∞), —á—Ç–æ —Ö–æ—á—É –¥–µ–ª–∞—Ç—å", {"CITRIN": 0.6, "AMETIST": 0.4}),
            AnswerOption("–ß–∞—â–µ –≤–∑—Ä–æ—Å–ª—ã–µ ‚Äî —è —Å–æ–≥–ª–∞—à–∞–ª—Å—è(–∞—Å—å)", {"YANTAR": 0.7}),
            AnswerOption("–ö–æ–º–±–∏–Ω–∞—Ü–∏—è: –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ + —Ä–µ—à–µ–Ω–∏–µ –≤–∑—Ä–æ—Å–ª—ã—Ö", {"RUBIN": 0.4, "YANTAR": 0.3}),
        ],
    )

    q["b1_q5_speaking"] = Question(
        id="b1_q5_speaking",
        block=1,
        text="–ö–∞–∫–æ–π —Ç—ã –±—ã–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ –ø–æ –æ–±—â–µ–Ω–∏—é?",
        allow_multiple=False,
        options=[
            AnswerOption("–ú–Ω–æ–≥–æ –≥–æ–≤–æ—Ä–∏–ª(–∞), —à—É—Ç–∏–ª(–∞), –ª—é–±–∏–ª(–∞) –∫–æ–º–ø–∞–Ω–∏—é", {"GELIODOR": 2, "GRANAT": 0.5}, inject_questions=["b1_q6_talk_detail"], tags=["network"]),
            AnswerOption("–¢–∏—Ö–∏–π(–∞—è), –Ω–∞–±–ª—é–¥–∞–ª(–∞), –±–æ–ª—å—à–µ —Å–ª—É—à–∞–ª(–∞)", {"AMETIST": 0.8, "SAPFIR": 0.8}, tags=["meaning"]),
            AnswerOption("–ü–æ-—Ä–∞–∑–Ω–æ–º—É: —Å –±–ª–∏–∑–∫–∏–º–∏ –∂–∏–≤–æ–π(–∞—è), —Å —á—É–∂–∏–º–∏ –∑–∞–∫—Ä—ã—Ç—ã–π(–∞—è)", {"GELIODOR": 0.6, "IZUMRUD": 0.4}, tags=["network"]),
        ],
    )

    q["b1_q6_animals"] = Question(
        id="b1_q6_animals",
        block=1,
        text="–ë—ã–ª–∏ –ª–∏ —É —Ç–µ–±—è –≤ –¥–µ—Ç—Å—Ç–≤–µ –¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –∏ –∫–∞–∫ —Ç—ã –∫ –Ω–∏–º –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å)?",
        allow_multiple=False,
        options=[
            AnswerOption("–î–∞, –æ—á–µ–Ω—å –ø—Ä–∏–≤—è–∑—ã–≤–∞–ª—Å—è(–∞—Å—å), —É—Ö–∞–∂–∏–≤–∞–ª(–∞), –ø–µ—Ä–µ–∂–∏–≤–∞–ª(–∞)", {"IZUMRUD": 2}, inject_questions=["b1_q5_animals_detail"], tags=["care"]),
            AnswerOption("–î–∞, –Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ, –±–µ–∑ —Å–∏–ª—å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", {"IZUMRUD": 0.7}),
            AnswerOption("–ü–æ—á—Ç–∏ –Ω–µ –±—ã–ª–æ / –Ω–µ–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ", {}),
        ],
    )

    q["b1_q7_body"] = Question(
        id="b1_q7_body",
        block=1,
        text="–ö–∞–∫ —Ç—ã –≤ –¥–µ—Ç—Å—Ç–≤–µ –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º –∏ —Å–ø–æ—Ä—Ç—É?",
        allow_multiple=False,
        options=[
            AnswerOption("–û–±–æ–∂–∞–ª(–∞) –¥–≤–∏–≥–∞—Ç—å—Å—è, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, —Ç–µ–ª–æ", {"SHUNGIT": 1.2, "CITRIN": 0.3}, inject_questions=["b1_q7_sport_detail"], tags=["sport"]),
            AnswerOption("–°–ø–æ—Ä—Ç –±—ã–ª, –Ω–æ –±–æ–ª—å—à–µ –∫–∞–∫ ¬´–Ω–∞–¥–æ¬ª", {"YANTAR": 0.6}),
            AnswerOption("–ò–∑–±–µ–≥–∞–ª(–∞) –Ω–∞–≥—Ä—É–∑–æ–∫, –ª—é–±–∏–ª(–∞) —Å–ø–æ–∫–æ–π–Ω–æ–µ", {"AMETIST": 0.5, "SAPFIR": 0.5}),
        ],
    )

    q["b1_q8_order"] = Question(
        id="b1_q8_order",
        block=1,
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ –ø–æ—Ä—è–¥–∫—É –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
        allow_multiple=False,
        options=[
            AnswerOption("–õ—é–±–∏–ª(–∞) —Ä–∞–∑–ª–æ–∂–∏—Ç—å –ø–æ –º–µ—Å—Ç–∞–º, —Ö–∞–æ—Å —Ä–∞–∑–¥—Ä–∞–∂–∞–ª", {"YANTAR": 2}, inject_questions=["b1_q8_order_tech_detail"], tags=["system"]),
            AnswerOption("–ù–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–ª—Å—è(–∞—Å—å)", {"YANTAR": 0.8}),
            AnswerOption("–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –±–µ—Å–ø–æ—Ä—è–¥–æ–∫ ‚Äî –≥–ª–∞–≤–Ω–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å", {"GRANAT": 0.4, "IZUMRUD": 0.6}, tags=["beauty"]),
        ],
    )

    q["b1_q9_reading"] = Question(
        id="b1_q9_reading",
        block=1,
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ —á—Ç–µ–Ω–∏—é –∏ –æ–±—É—á–µ–Ω–∏—é –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
        allow_multiple=False,
        options=[
            AnswerOption("–ú–Ω–æ–≥–æ —á–∏—Ç–∞–ª(–∞) —Å–∞–º(–∞), –ª—é–±–∏–ª(–∞) –Ω–æ–≤–æ–µ", {"AMETIST": 1.6, "SAPFIR": 0.6}, inject_questions=["b1_q2_reading_detail"], tags=["thinking"]),
            AnswerOption("–ß–∏—Ç–∞–ª(–∞) –µ—Å–ª–∏ –Ω–∞–¥–æ, —Å–∞–º(–∞) —Ä–µ–¥–∫–æ –≤—ã–±–∏—Ä–∞–ª(–∞)", {"YANTAR": 0.5}),
            AnswerOption("–ß—Ç–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–≤–ª–µ–∫–∞–ª–æ", {}),
        ],
    )

    q["b1_q10_money_play"] = Question(
        id="b1_q10_money_play",
        block=1,
        text="–ë—ã–ª–∏ –ª–∏ –∏–≥—Ä—ã/–∑–∞–Ω—è—Ç–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–µ–Ω—å–≥–∞–º–∏, –ø—Ä–æ–¥–∞–∂–∞–º–∏, –æ–±–º–µ–Ω–æ–º?",
        allow_multiple=False,
        options=[
            AnswerOption("–î–∞, —Ç–æ—Ä–≥–æ–≤–∞—Ç—å—Å—è/–ø—Ä–æ–¥–∞–≤–∞—Ç—å/–æ–±–º–µ–Ω–∏–≤–∞—Ç—å –±—ã–ª–æ –∫–∞–π—Ñ", {"CITRIN": 2}, inject_questions=["b1_q3_trading_detail"], tags=["money"]),
            AnswerOption("–ò–Ω–æ–≥–¥–∞, –Ω–æ –±–µ–∑ —Å–∏–ª—å–Ω–æ–π —Ç—è–≥–∏", {"CITRIN": 0.8}),
            AnswerOption("–ù–µ—Ç, –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–æ", {}),
        ],
    )

    q["b1_q11_scene_vs_director"] = Question(
        id="b1_q11_scene_vs_director",
        block=1,
        text="–®–∫–æ–ª—å–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫: –≥–¥–µ —Ç—ã —á–∞—â–µ?",
        allow_multiple=False,
        options=[
            AnswerOption("–ù–∞ —Å—Ü–µ–Ω–µ, –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è", {"GRANAT": 1.6}, tags=["stage"]),
            AnswerOption("–ó–∞ –∫–∞–¥—Ä–æ–º: —Å—Ü–µ–Ω–∞—Ä–∏–π/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è/—Ç–∞–π–º–∏–Ω–≥", {"YANTAR": 1.0, "RUBIN": 0.7}, tags=["system"]),
            AnswerOption("–í –∑–∞–ª–µ: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å/–Ω–∞–±–ª—é–¥–∞—Ç—å", {"IZUMRUD": 0.8, "SAPFIR": 0.6}),
        ],
    )

    q["b1_q12_empathy"] = Question(
        id="b1_q12_empathy",
        block=1,
        text="–ù–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –±—ã–ª(–∞) —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º —Ä–µ–±—ë–Ω–∫–æ–º?",
        allow_multiple=False,
        options=[
            AnswerOption("–û—á–µ–Ω—å: –º–æ–≥(–ª–∞) –ø–ª–∞–∫–∞—Ç—å, –∂–∞–ª–∫–æ –ª—é–¥–µ–π/–∂–∏–≤–æ—Ç–Ω—ã—Ö", {"IZUMRUD": 1.2, "SAPFIR": 1.0}),
            AnswerOption("–°—Ä–µ–¥–Ω–µ: –∏–Ω–æ–≥–¥–∞ —Ç—Ä–æ–≥–∞–ª–æ", {"IZUMRUD": 0.7}),
            AnswerOption("–†–µ–¥–∫–æ: –±–æ–ª—å—à–µ —Ä–∞–∑—É–º", {"AMETIST": 0.8}),
        ],
    )

    q["b1_q13_dreams"] = Question(
        id="b1_q13_dreams",
        block=1,
        text="–û —á—ë–º —Ç—ã –º–µ—á—Ç–∞–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ/–ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ? (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)",
        allow_multiple=True,
        options=[
            AnswerOption("–ò–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç—å, —Å—Ü–µ–Ω–∞, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ", {"GRANAT": 1.6, "GELIODOR": 0.6}, tags=["stage"]),
            AnswerOption("–°–≤–æ–π –±–∏–∑–Ω–µ—Å/–¥–µ–ª–æ, –±—ã—Ç—å —Ö–æ–∑—è–∏–Ω–æ–º", {"CITRIN": 1.6, "RUBIN": 0.4}, tags=["money"]),
            AnswerOption("–ü–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º, —É—á–∏—Ç—å/–ª–µ—á–∏—Ç—å, –¥–µ–ª–∞—Ç—å –º–∏—Ä –ª—É—á—à–µ", {"SAPFIR": 1.6, "IZUMRUD": 0.6}, tags=["meaning"]),
            AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, —ç—Å—Ç–µ—Ç–∏–∫–∞ –≤–æ–∫—Ä—É–≥", {"IZUMRUD": 1.3, "RUBIN": 0.7}, tags=["beauty"]),
            AnswerOption("–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –¥–æ–º/—É—é—Ç", {"YANTAR": 1.6}, tags=["system"]),
        ],
    )

    q["b1_q14_chaos_reaction"] = Question(
        id="b1_q14_chaos_reaction",
        block=1,
        text="–ö–æ–º–Ω–∞—Ç–∞ –≤ —Ö–∞–æ—Å–µ. –¢–≤–æ—è —Ä–µ–∞–∫—Ü–∏—è?",
        allow_multiple=False,
        options=[
            AnswerOption("–•–æ—á—É —Ä–∞–∑–ª–æ–∂–∏—Ç—å –ø–æ –º–µ—Å—Ç–∞–º ‚Äî —Å–ª–æ–∂–Ω–æ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è", {"YANTAR": 1.6}, tags=["system"]),
            AnswerOption("–ù–∞–≤—ë–ª(–ª–∞) –±—ã –ø–æ—Ä—è–¥–æ–∫, –Ω–æ –Ω–µ —Å—Ä–∞–∑—É", {"YANTAR": 0.8}),
            AnswerOption("–ù–µ –Ω–∞–ø—Ä—è–≥–∞–ª–æ ‚Äî –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ/–≤–µ—Å–µ–ª–æ", {"GRANAT": 0.4, "RUBIN": 0.4}),
        ],
    )

    q["b1_q15_competition"] = Question(
        id="b1_q15_competition",
        block=1,
        text="–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏–ª—Å—è(–∞—Å—å) –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º?",
        allow_multiple=False,
        options=[
            AnswerOption("–í–∞–∂–Ω–æ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º, —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞–ª(–∞) –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ª—É—á—à–µ", {"CITRIN": 1.0, "GRANAT": 0.4, "SHUNGIT": 0.4}),
            AnswerOption("–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º", {"SHUNGIT": 0.5}),
            AnswerOption("–ù–µ –ª—é–±–∏–ª(–∞) —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –∏–∑–±–µ–≥–∞–ª(–∞)", {"SAPFIR": 0.6, "AMETIST": 0.4}),
        ],
    )

    # --- –í–µ—Ç–∫–∏ ---
    q["b1_q5_animals_detail"] = Question(
        id="b1_q5_animals_detail",
        block=1,
        text="–ß—Ç–æ –±—ã–ª–æ —Å–∞–º—ã–º –≤–∞–∂–Ω—ã–º –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –∫ –∂–∏–≤–æ—Ç–Ω—ã–º?",
        allow_multiple=False,
        options=[
            AnswerOption("–ö–æ–º—Ñ–æ—Ä—Ç/—Ç–µ–ø–ª–æ/—Å—ã—Ç–æ—Å—Ç—å/—É—Ö–æ–¥", {"IZUMRUD": 1.0, "YANTAR": 0.6}),
            AnswerOption("–ö–æ–Ω—Ç–∞–∫—Ç/–ª—é–±–æ–≤—å/–æ–±–Ω–∏–º–∞—Ç—å/–∏–≥—Ä–∞—Ç—å", {"IZUMRUD": 1.2}),
            AnswerOption("–ù–∞–±–ª—é–¥–∞—Ç—å ‚Äî –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã", {"AMETIST": 0.6, "IZUMRUD": 0.4}),
        ],
    )

    q["b1_q7_sport_detail"] = Question(
        id="b1_q7_sport_detail",
        block=1,
        text="–ß—Ç–æ –≤ —Å–ø–æ—Ä—Ç–µ/–¥–≤–∏–∂–µ–Ω–∏–∏ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        allow_multiple=False,
        options=[
            AnswerOption("–°–∏–ª–∞ —Ç–µ–ª–∞/—É—Å—Ç–∞–ª–æ—Å—Ç—å/–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ", {"SHUNGIT": 1.4}, tags=["sport"]),
            AnswerOption("–ü–æ–±–µ–¥–∞/–º–µ–¥–∞–ª–∏/–±—ã—Ç—å –ø–µ—Ä–≤—ã–º", {"CITRIN": 1.2}, tags=["sport"]),
            AnswerOption("–ö–æ–º–∞–Ω–¥–∞/—ç–Ω–µ—Ä–≥–∏—è –≥—Ä—É–ø–ø—ã/–æ–±—â–µ–Ω–∏–µ", {"GELIODOR": 0.8, "SHUNGIT": 0.4}, tags=["network"]),
        ],
    )

    q["b1_q4_stage_detail"] = Question(
        id="b1_q4_stage_detail",
        block=1,
        text="–ß—Ç–æ –ø—Ä–∏—Ç—è–≥–∏–≤–∞–ª–æ –≤ —Å—Ü–µ–Ω–µ/–≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è—Ö?",
        allow_multiple=False,
        options=[
            AnswerOption("–†–µ–∞–∫—Ü–∏—è –ª—é–¥–µ–π, –≤–Ω–∏–º–∞–Ω–∏–µ, —ç–º–æ—Ü–∏–∏", {"GRANAT": 1.4, "GELIODOR": 0.4}),
            AnswerOption("–ü—Ä–∏–¥—É–º–∞—Ç—å –Ω–æ–º–µ—Ä/–æ–±—Ä–∞–∑/—Å—Ü–µ–Ω–∞—Ä–∏–π/–∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç", {"RUBIN": 0.8, "IZUMRUD": 0.6, "YANTAR": 0.2}),
            AnswerOption("–ü–µ—Ä–µ–¥–∞—Ç—å –≥–ª—É–±–æ–∫—É—é –∏—Å—Ç–æ—Ä–∏—é/—Å–º—ã—Å–ª", {"SAPFIR": 0.8, "GRANAT": 0.6}),
        ],
    )

    q["b1_q6_talk_detail"] = Question(
        id="b1_q6_talk_detail",
        block=1,
        text="–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –æ–±—â–µ–Ω–∏—è –±—ã–ª –±–ª–∏–∂–µ?",
        allow_multiple=False,
        options=[
            AnswerOption("–®—É—Ç–∏—Ç—å/—Ä–∞–∑–≤–ª–µ–∫–∞—Ç—å/–ø–æ–¥–Ω–∏–º–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", {"GELIODOR": 1.2, "GRANAT": 0.4}),
            AnswerOption("–†–∞–∑–≥–æ–≤–æ—Ä—ã –ø–æ –¥—É—à–∞–º –æ–¥–∏–Ω –Ω–∞ –æ–¥–∏–Ω", {"SAPFIR": 0.7, "IZUMRUD": 0.5}),
            AnswerOption("–ò–¥–µ–∏/–ø–ª–∞–Ω—ã/–∫–∞–∫ —É–ª—É—á—à–∏—Ç—å/–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å", {"AMETIST": 0.6, "YANTAR": 0.4, "CITRIN": 0.4}),
        ],
    )

    q["b1_q2_reading_detail"] = Question(
        id="b1_q2_reading_detail",
        block=1,
        text="–ö–∞–∫–∏–µ –∫–Ω–∏–≥–∏/–º–∞—Ç–µ—Ä–∏–∞–ª—ã –±—ã–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ?",
        allow_multiple=False,
        options=[
            AnswerOption("–ù–∞—É—á–ø–æ–ø/—ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏/–∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ", {"AMETIST": 1.2, "YANTAR": 0.4}),
            AnswerOption("–°—É–¥—å–±—ã –ª—é–¥–µ–π/–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è/—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è/—Å–º—ã—Å–ª", {"SAPFIR": 1.2, "IZUMRUD": 0.4}),
            AnswerOption("–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞/–º–∏—Ä—ã/–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è", {"RUBIN": 0.8, "SAPFIR": 0.4}),
            AnswerOption("–ü—Ä–∞–∫—Ç–∏—á–Ω–æ: –¥–µ–Ω—å–≥–∏/–±–∏–∑–Ω–µ—Å/—É—Å–ø–µ—Ö", {"CITRIN": 1.2}),
        ],
    )

    q["b1_q3_trading_detail"] = Question(
        id="b1_q3_trading_detail",
        block=1,
        text="–ß—Ç–æ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –≤ –∏–≥—Ä–∞—Ö ¬´–º–∞–≥–∞–∑–∏–Ω¬ª / –ø—Ä–æ–¥–∞–∂–∞—Ö / –æ–±–º–µ–Ω–∞—Ö?",
        allow_multiple=False,
        options=[
            AnswerOption("–°–¥–µ–ª–∫–∞: –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, –∑–∞–∫—Ä—ã—Ç—å, –ø—Ä–æ–¥–∞—Ç—å –≤—ã–≥–æ–¥–Ω–µ–µ", {"CITRIN": 1.4, "GELIODOR": 0.4}),
            AnswerOption("–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: –≤–∏—Ç—Ä–∏–Ω–∞, —É–ø–∞–∫–æ–≤–∫–∞, –∫—Ä–∞—Å–∏–≤–æ", {"IZUMRUD": 1.2, "YANTAR": 0.3}),
            AnswerOption("–°—á–∏—Ç–∞—Ç—å/–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å/—É—á—ë—Ç", {"YANTAR": 1.2, "AMETIST": 0.4}),
        ],
    )

    q["b1_q8_order_tech_detail"] = Question(
        id="b1_q8_order_tech_detail",
        block=1,
        text="–ß—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –≤ –ø–æ—Ä—è–¥–∫–µ/—Å—Ç—Ä—É–∫—Ç—É—Ä–µ/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö?",
        allow_multiple=False,
        options=[
            AnswerOption("–ß–∏—Å—Ç–æ/–∞–∫–∫—É—Ä–∞—Ç–Ω–æ/–ø–æ –ø–æ–ª–æ—á–∫–∞–º", {"YANTAR": 1.4}),
            AnswerOption("–†–∞–∑–æ–±—Ä–∞—Ç—å/–ø–æ–Ω—è—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏", {"AMETIST": 0.8, "YANTAR": 0.6}),
            AnswerOption("–£–¥–æ–±–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ", {"IZUMRUD": 0.7, "YANTAR": 0.5}),
        ],
    )

    q["b1_q9_music_detail"] = Question(
        id="b1_q9_music_detail",
        block=1,
        text="–ö–∞–∫—É—é —Ä–æ–ª—å –∑–∞–Ω–∏–º–∞–ª–∞ –º—É–∑—ã–∫–∞/–ø–µ–Ω–∏–µ?",
        allow_multiple=False,
        options=[
            AnswerOption("–•–æ—Ç–µ–ª(–∞) –≤—ã—Å—Ç—É–ø–∞—Ç—å/–ø–µ—Ç—å, –Ω–æ –∏–Ω–æ–≥–¥–∞ –±—ã–ª–æ —Å—Ç—Ä–∞—à–Ω–æ", {"GELIODOR": 1.0, "GRANAT": 0.4}),
            AnswerOption("–ë–æ–ª—å—à–µ —Å–ª—É—à–∞—Ç—å/—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –º—É–∑—ã–∫—É, —á–µ–º –≤—ã—Å—Ç—É–ø–∞—Ç—å", {"SAPFIR": 0.6, "IZUMRUD": 0.4}),
            AnswerOption("–ú—É–∑—ã–∫–∞ –Ω–µ –∏–≥—Ä–∞–ª–∞ —Ä–æ–ª–∏", {}),
        ],
    )

    return q


CORE_SEQUENCE_BLOCK1 = [
    "b1_q1_free_play",
    "b1_q2_subjects",
    "b1_q3_clubs",
    "b1_q4_choice",
    "b1_q5_speaking",
    "b1_q6_animals",
    "b1_q7_body",
    "b1_q8_order",
    "b1_q9_reading",
    "b1_q10_money_play",
    "b1_q11_scene_vs_director",
    "b1_q12_empathy",
    "b1_q13_dreams",
    "b1_q14_chaos_reaction",
    "b1_q15_competition",
]


# ============================
# –ë–ª–æ–∫ 2 ‚Äî —Ä–∞–±–æ—Ç–∞/–ø—Ä–æ—Ü–µ—Å—Å—ã/—Å–º–µ—â–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 15)
# ============================

def build_block2_questions() -> List[Question]:
    q: List[Question] = []

    def Q(_id: str, text: str, options: List[AnswerOption], multi: bool = True) -> Question:
        return Question(id=_id, block=2, text=text, allow_multiple=multi, options=options)

    # 1
    q.append(Q(
        "b2_q1_role_now",
        "1) –ß–µ–º —Ç—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è —Å–µ–π—á–∞—Å (–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2‚Äì3 –≥–æ–¥–∞)?",
        [
            AnswerOption("–ü—Ä–æ–¥–∞–∂–∏/—Å–¥–µ–ª–∫–∏/–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã/–∑–∞–∫—Ä—ã—Ç–∏–µ", {"CITRIN": 1.2, "GELIODOR": 0.4}, tags=["money"]),
            AnswerOption("–û–±—É—á–µ–Ω–∏–µ/–Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ/–æ–±—ä—è—Å–Ω—è—Ç—å –ª—é–¥—è–º", {"GELIODOR": 1.2, "SAPFIR": 0.3}, tags=["network"]),
            AnswerOption("–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫–∞/–ø—Ä–æ—Ü–µ—Å—Å—ã/—Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã/—Ç–∞–±–ª–∏—Ü—ã", {"YANTAR": 1.2, "AMETIST": 0.3}, tags=["system"]),
            AnswerOption("–ê–Ω–∞–ª–∏—Ç–∏–∫–∞/—Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏–π", {"AMETIST": 1.2, "YANTAR": 0.4}, tags=["thinking"]),
            AnswerOption("–ö–æ–Ω—Ç–µ–Ω—Ç/–ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å/–≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è/–≤–∏–¥–∏–º–æ—Å—Ç—å", {"GRANAT": 1.0, "GELIODOR": 0.5}, tags=["stage"]),
            AnswerOption("–¢–µ–ª–æ/—Å–ø–æ—Ä—Ç/–ø–æ–ª–µ–≤—ã–µ –∑–∞–¥–∞—á–∏/–¥–≤–∏–∂–µ–Ω–∏–µ", {"SHUNGIT": 1.0, "RUBIN": 0.2}, tags=["sport"]),
            AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/–≤–∏–∑—É–∞–ª/—Å—Ç–∏–ª—å/—ç—Å—Ç–µ—Ç–∏–∫–∞", {"IZUMRUD": 1.2}, tags=["beauty"]),
        ],
        multi=True
    ))

    # 2
    q.append(Q(
        "b2_q2_like_job",
        "2) –¢–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ—è —Ç–µ–∫—É—â–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Ü–µ–ª–æ–º?",
        [
            AnswerOption("–î–∞, —è –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ", {"SAPFIR": 0.2}),
            AnswerOption("–°–∫–æ—Ä–µ–µ –¥–∞, –Ω–æ –µ—Å—Ç—å –≤—ã–º–∞—Ç—ã–≤–∞—é—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã", {"YANTAR": 0.2}),
            AnswerOption("–°–∫–æ—Ä–µ–µ –Ω–µ—Ç, —á—É–≤—Å—Ç–≤—É—é ¬´–Ω–µ —Å–≤–æ—ë¬ª", {"SAPFIR": 0.6}),
            AnswerOption("–í–æ–æ–±—â–µ –Ω–µ—Ç, –¥–µ—Ä–∂—É—Å—å –Ω–∞ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏/–¥–µ–Ω—å–≥–∞—Ö", {"SAPFIR": 0.8, "CITRIN": 0.2}),
        ],
        multi=False
    ))

    # 3
    q.append(Q(
        "b2_q3_ideal_roles",
        "3) –ï—Å–ª–∏ –¥–µ–Ω—å–≥–∏ —É–±—Ä–∞—Ç—å: –∫–∞–∫–∏–µ 2‚Äì3 —Ä–æ–ª–∏ —Ç—ã –±—ã –≤—ã–±—Ä–∞–ª(–∞) –ø–æ –ª—é–±–≤–∏?",
        [
            AnswerOption("–ü–µ–¥–∞–≥–æ–≥/–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫/–æ–±—É—á–µ–Ω–∏–µ", {"GELIODOR": 1.2, "SAPFIR": 0.4}, tags=["network"]),
            AnswerOption("–ü—Ä–æ–¥–∞–∫—Ç/–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å/—Å–æ–∑–¥–∞—Ç–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç–∞", {"CITRIN": 1.2, "RUBIN": 0.4}, tags=["money"]),
            AnswerOption("–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ª–∏–¥–µ—Ä/—Å–∏—Å—Ç–µ–º—â–∏–∫", {"YANTAR": 1.2}, tags=["system"]),
            AnswerOption("–ê–Ω–∞–ª–∏—Ç–∏–∫/—Å—Ç—Ä–∞—Ç–µ–≥/–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Ä–µ—à–µ–Ω–∏–π", {"AMETIST": 1.2, "YANTAR": 0.4}, tags=["thinking"]),
            AnswerOption("–°—Ü–µ–Ω–∞/–≤–µ–¥—É—â–∏–π/–ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å", {"GRANAT": 1.2, "GELIODOR": 0.6}, tags=["stage"]),
            AnswerOption("–î–≤–∏–∂/–ø–æ–µ–∑–¥–∫–∏/—Å–æ–±—ã—Ç–∏—è/—ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏", {"RUBIN": 1.2}, tags=["adrenaline"]),
            AnswerOption("–≠—Å—Ç–µ—Ç–∏–∫–∞/–¥–∏–∑–∞–π–Ω/–≤–∏–∑—É–∞–ª/—Å—Ç–∏–ª—å", {"IZUMRUD": 1.2}, tags=["beauty"]),
            AnswerOption("–¢–µ–ª–æ/—Å–ø–æ—Ä—Ç/—Ñ–∏–∑. –ø—Ä–∞–∫—Ç–∏–∫–∞", {"SHUNGIT": 1.2}, tags=["sport"]),
        ],
        multi=True
    ))

    # 4
    q.append(Q(
        "b2_q4_flow_tasks",
        "4) –í –∫–∞–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö —Ç—ã –∑–∞–ª–∏–ø–∞–µ—à—å –∏ —Ç–µ—Ä—è–µ—à—å —Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏?",
        [
            AnswerOption("–†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –¥–æ —Å—É—Ç–∏, –∞–Ω–∞–ª–∏–∑, –ª–æ–≥–∏–∫–∞", {"AMETIST": 1.2}, tags=["thinking"]),
            AnswerOption("–°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å: —Ç–∞–±–ª–∏—Ü—ã, –ø–æ—Ä—è–¥–æ–∫, –ø—Ä–æ—Ü–µ—Å—Å", {"YANTAR": 1.2}, tags=["system"]),
            AnswerOption("–û–±—É—á–∞—Ç—å/–æ–±—ä—è—Å–Ω—è—Ç—å/–≤–µ—Å—Ç–∏ –ª—é–¥–µ–π", {"GELIODOR": 1.2}, tags=["network"]),
            AnswerOption("–ó–∞–∫—Ä—ã–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏/–¥–æ–∂–∏–º–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç", {"CITRIN": 1.2}, tags=["money"]),
            AnswerOption("–î–≤–∏–∂/—Å–∫–æ—Ä–æ—Å—Ç—å/–ø–æ–µ–∑–¥–∫–∏/–Ω–æ–≤–æ–µ", {"RUBIN": 1.2}, tags=["adrenaline"]),
            AnswerOption("–¢–µ–ª–æ/—Å–ø–æ—Ä—Ç/—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏", {"SHUNGIT": 1.2}, tags=["sport"]),
            AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/–≤–∏–∑—É–∞–ª/–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞", {"IZUMRUD": 1.2}, tags=["beauty"]),
        ],
        multi=True
    ))

    # 5
    q.append(Q(
        "b2_q5_hate_tasks",
        "5) –ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ —Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—à—å (–Ω–µ –ª—é–±–∏—à—å)?",
        [
            AnswerOption("–†—É—Ç–∏–Ω–∞/–¥–æ–∫—É–º–µ–Ω—Ç—ã/—Ç–∞–±–ª–∏—Ü—ã", {"YANTAR": -0.6}),
            AnswerOption("–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã/–¥–æ–∂–∏–º/—Ü–µ–Ω—ã/—Ç–æ—Ä–≥", {"CITRIN": -0.6}),
            AnswerOption("–ü—É–±–ª–∏—á–Ω–æ—Å—Ç—å/–≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ/–≤–Ω–∏–º–∞–Ω–∏–µ", {"GRANAT": -0.6}),
            AnswerOption("–î–æ–ª–≥–∏–π –∞–Ω–∞–ª–∏–∑/–∫–æ–ø–∞–Ω–∏–µ", {"AMETIST": -0.4}),
            AnswerOption("–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞–∑–±–æ—Ä–∫–∏/–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã", {"GRANAT": -0.4}),
            AnswerOption("–§–∏–∑. –Ω–∞–≥—Ä—É–∑–∫–∞/—Å–ø–æ—Ä—Ç", {"SHUNGIT": -0.4}),
            AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –±–µ–∑ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤", {"IZUMRUD": -0.4}),
        ],
        multi=True
    ))

    # 6
    q.append(Q(
        "b2_q6_decision_style",
        "6) –ö–∞–∫ —Ç—ã –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è —á–∞—â–µ –≤—Å–µ–≥–æ?",
        [
            AnswerOption("–ß–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑ –∏ —Ñ–∞–∫—Ç—ã", {"AMETIST": 1.0, "YANTAR": 0.4}),
            AnswerOption("–ß–µ—Ä–µ–∑ –≤—ã–≥–æ–¥—É/—Ü–∏—Ñ—Ä—ã/—Ä–µ–∑—É–ª—å—Ç–∞—Ç", {"CITRIN": 1.0}),
            AnswerOption("–ß–µ—Ä–µ–∑ –ª—é–¥–µ–π/–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏/—Å–æ–≤–µ—Ç—ã", {"GELIODOR": 0.8}),
            AnswerOption("–ß–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–º—ã—Å–ª/¬´–∑–Ω–∞–∫¬ª", {"SAPFIR": 1.0}),
            AnswerOption("–ß–µ—Ä–µ–∑ –∏–º–ø—É–ª—å—Å/—Ä–∏—Å–∫/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫", {"RUBIN": 1.0}),
            AnswerOption("–ß–µ—Ä–µ–∑ —Ç–µ–ª–æ/–æ—â—É—â–µ–Ω–∏—è", {"SHUNGIT": 0.8, "IZUMRUD": 0.2}),
        ],
        multi=True
    ))

    # 7
    q.append(Q(
        "b2_q7_money_relation",
        "7) –¢–≤–æ–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –¥–µ–Ω—å–≥–∞–º–∏ –∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–µ–π —Ç–∞–ª–∞–Ω—Ç–æ–≤?",
        [
            AnswerOption("–õ—é–±–ª—é —Å—á–∏—Ç–∞—Ç—å/–ø—Ä–æ–¥–∞–≤–∞—Ç—å/–¥–µ–ª–∞—Ç—å –ø—Ä–∏–±—ã–ª—å–Ω–æ", {"CITRIN": 1.2}, tags=["money"]),
            AnswerOption("–î–µ–Ω—å–≥–∏ –≤–∞–∂–Ω—ã, –Ω–æ —Å–º—ã—Å–ª –≤–∞–∂–Ω–µ–µ", {"SAPFIR": 0.8}),
            AnswerOption("–°–ª–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Ü–µ–Ω—É/–ø—Ä–æ—Å–∏—Ç—å –¥–µ–Ω—å–≥–∏", {"CITRIN": -0.4, "SAPFIR": 0.2}),
            AnswerOption("–Ø –ª—É—á—à–µ —Å–¥–µ–ª–∞—é —Ö–æ—Ä–æ—à–æ, –∞ –¥–µ–Ω—å–≥–∏ –∫–∞–∫-–Ω–∏–±—É–¥—å –ø—Ä–∏–¥—É—Ç", {"YANTAR": 0.2, "IZUMRUD": 0.2}),
        ],
        multi=True
    ))

    # 8
    q.append(Q(
        "b2_q8_network",
        "8) –ß—Ç–æ –¥–ª—è —Ç–µ–±—è –Ω–µ—Ç–≤–æ—Ä–∫/—Å–≤—è–∑–∏/–ª—é–¥–∏?",
        [
            AnswerOption("–Ø –ª—é–±–ª—é —Å–æ–µ–¥–∏–Ω—è—Ç—å –ª—é–¥–µ–π –∏ –±—ã—Ç—å –º–æ—Å—Ç–æ–º", {"GELIODOR": 1.2}, tags=["network"]),
            AnswerOption("–ú–Ω–µ –≤–∞–∂–Ω–æ –≤–ª–∏—è–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ –æ–∫—Ä—É–∂–µ–Ω–∏–µ", {"GRANAT": 0.8, "CITRIN": 0.4}),
            AnswerOption("–Ø –≤—ã–±–∏—Ä–∞—é —É–∑–∫–∏–π –∫—Ä—É–≥, –≥–ª—É–±–∏–Ω–∞ –≤–∞–∂–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞", {"SAPFIR": 0.6, "IZUMRUD": 0.2}),
            AnswerOption("–Ø —É—Å—Ç–∞—é –æ—Ç –ª—é–¥–µ–π, –ª—é–±–ª—é –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ", {"AMETIST": 0.4}),
        ],
        multi=True
    ))

    # 9
    q.append(Q(
        "b2_q9_teaching",
        "9) –ï—Å–ª–∏ —Ç—ã –æ–±—É—á–∞–µ—à—å/–æ–±—ä—è—Å–Ω—è–µ—à—å: —á—Ç–æ —Ç–µ–±—è –≤ —ç—Ç–æ–º —Ä–µ–∞–ª—å–Ω–æ –∑–∞–≤–æ–¥–∏—Ç?",
        [
            AnswerOption("–í–∏–¥–µ—Ç—å, –∫–∞–∫ —É —á–µ–ª–æ–≤–µ–∫–∞ ¬´—â—ë–ª–∫–Ω—É–ª–æ¬ª", {"GELIODOR": 1.0, "SAPFIR": 0.4}),
            AnswerOption("–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ–µ –≤ –ø—Ä–æ—Å—Ç–æ–µ", {"YANTAR": 0.8, "AMETIST": 0.6}),
            AnswerOption("–ë—ã—Ç—å –ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã–º/–æ—Ü–µ–Ω—ë–Ω–Ω—ã–º", {"GRANAT": 0.8}),
            AnswerOption("–î–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–±—É—á–µ–Ω–∏—è/–ø—Ä–æ—Ü–µ—Å—Å", {"YANTAR": 1.0}),
        ],
        multi=True
    ))

    # 10
    q.append(Q(
        "b2_q10_order",
        "10) –ü–æ—Ä—è–¥–æ–∫/—É–±–æ—Ä–∫–∞/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚Äî —ç—Ç–æ –ø—Ä–æ —á—Ç–æ –¥–ª—è —Ç–µ–±—è?",
        [
            AnswerOption("–ú–µ–Ω—è —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç, –≤ –≥–æ–ª–æ–≤–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∏—Å—Ç–æ", {"YANTAR": 1.2}),
            AnswerOption("–Ø –≤–∏–∂—É, —á—Ç–æ —Å–ª–æ–º–∞–Ω–æ ‚Äî –∏ —á–∏–Ω—é", {"YANTAR": 1.0, "AMETIST": 0.4}),
            AnswerOption("–≠—Ç–æ –ø—Ä–æ –∫–æ–Ω—Ç—Ä–æ–ª—å, –∏–Ω–∞—á–µ —Ç—Ä–µ–≤–æ–∂–Ω–æ", {"YANTAR": 0.8}),
            AnswerOption("–≠—Ç–æ –ø—Ä–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç", {"CITRIN": 0.6, "YANTAR": 0.4}),
        ],
        multi=True
    ))

    # 11
    q.append(Q(
        "b2_q11_sport_style",
        "11) –°–ø–æ—Ä—Ç/–¥–≤–∏–∂–µ–Ω–∏–µ: —á—Ç–æ —Ç–µ–±—è –≤ —ç—Ç–æ–º —Ü–µ–ø–ª—è–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        [
            AnswerOption("–¢–æ–Ω—É—Å, —Å–∏–ª–∞, —Ç–µ–ª–æ, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å", {"SHUNGIT": 1.2}, tags=["sport"]),
            AnswerOption("–°–∫–æ—Ä–æ—Å—Ç—å, –ø–æ–±–µ–¥–∞, —Å—á—ë—Ç, –±—ã—Ç—å –ø–µ—Ä–≤—ã–º", {"CITRIN": 1.2}, tags=["sport"]),
            AnswerOption("–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω, –∏–≥—Ä–∞, –¥—Ä–∞–π–≤, —ç–º–æ—Ü–∏–∏", {"RUBIN": 1.2}, tags=["sport"]),
            AnswerOption("–ö–æ–º–∞–Ω–¥–∞ –∏ –æ–±—â–µ–Ω–∏–µ", {"GELIODOR": 0.8}),
        ],
        multi=True
    ))

    # 12
    q.append(Q(
        "b2_q12_first_place",
        "12) –ü—Ä–æ ¬´–±—ã—Ç—å –ø–µ—Ä–≤—ã–º¬ª: —ç—Ç–æ —É —Ç–µ–±—è –ø—Ä–æ‚Ä¶",
        [
            AnswerOption("–ü–æ–±–µ–¥–∞ = –¥–æ–∫–∞–∑–∞—Ç—å —Å–µ–±–µ –∏ –¥—Ä—É–≥–∏–º", {"CITRIN": 1.0, "GRANAT": 0.4}),
            AnswerOption("–≠—Ç–æ –∞–∑–∞—Ä—Ç/–∏–≥—Ä–∞/–≤–∫–ª—é—á–µ–Ω–∏–µ", {"RUBIN": 0.8, "CITRIN": 0.4}),
            AnswerOption("–≠—Ç–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ —Å–∏—Å—Ç–µ–º–∞", {"YANTAR": 0.8}),
            AnswerOption("–ú–Ω–µ –Ω–µ –≤–∞–∂–Ω–æ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º", {"SAPFIR": 0.2}),
        ],
        multi=False
    ))

    # 13
    q.append(Q(
        "b2_q13_family",
        "13) –°–µ–º—å—è/–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: —á—Ç–æ —Ç—ã –≥–æ—Ç–æ–≤(–∞) –¥–µ–ª–∞—Ç—å —Ä–∞–¥–∏ —Å–µ–º—å–∏?",
        [
            AnswerOption("–í–∫–ª—é—á–∞—é —Ä–µ–∂–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ –∑–∞–∫—Ä—ã–≤–∞—é –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å", {"CITRIN": 0.8}),
            AnswerOption("–î–µ—Ä–∂—É –ø–æ—Ä—è–¥–æ–∫ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", {"YANTAR": 0.8}),
            AnswerOption("–°—Ç–∞–Ω–æ–≤–ª—é—Å—å –º—è–≥–∫–∏–º(–æ–π), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é, –±–µ—Ä–µ–≥—É", {"IZUMRUD": 0.6}),
            AnswerOption("–ì–æ—Ç–æ–≤(–∞) –Ω–∞ —Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω—ã/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ä–∞–¥–∏ —Å–µ–º—å–∏", {"RUBIN": 0.6}),
        ],
        multi=True
    ))

    # 14
    q.append(Q(
        "b2_q14_depression",
        "14) –ï—Å–ª–∏ —Å–µ–π—á–∞—Å –º–∞–ª–æ —Å–º—ã—Å–ª–∞/–∞–ø–∞—Ç–∏—è: —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–∂–∏–≤–∞—Ç—å —Ö–æ—Ç—å —á—É—Ç—å-—á—É—Ç—å?",
        [
            AnswerOption("–î–≤–∏–∂–µ–Ω–∏–µ/—Å–ø–æ—Ä—Ç/—Ç–µ–ª–æ", {"SHUNGIT": 0.6}),
            AnswerOption("–ù–æ–≤—ã–π –æ–ø—ã—Ç/–ø–æ–µ–∑–¥–∫–∞/—Å–º–µ–Ω–∞ –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∏", {"RUBIN": 0.8}),
            AnswerOption("–ü–æ—Ä—è–¥–æ–∫/—É–±–æ—Ä–∫–∞/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞", {"YANTAR": 0.6}),
            AnswerOption("–†–∞–∑–≥–æ–≤–æ—Ä/–ª—é–¥–∏/–ø–æ–¥–¥–µ—Ä–∂–∫–∞", {"GELIODOR": 0.6}),
            AnswerOption("–°–º—ã—Å–ª/–≤–µ—Ä–∞/–º–∏—Å—Å–∏—è/—Ä–∞–∑–≥–æ–≤–æ—Ä –æ ¬´–∑–∞—á–µ–º¬ª", {"SAPFIR": 0.8}),
        ],
        multi=True
    ))

    # 15
    q.append(Q(
        "b2_q15_conflict",
        "15) –ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Å–∏–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –ª—é–¥–µ–π?",
        [
            AnswerOption("–ò–∑–±–µ–≥–∞—é ‚Äî –º–Ω–µ —Ç—è–∂–µ–ª–æ", {"GRANAT": -0.4, "IZUMRUD": 0.2}),
            AnswerOption("–£–º–µ—é –¥–µ—Ä–∂–∞—Ç—å —Ä–∞–º–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞", {"YANTAR": 0.4}),
            AnswerOption("–í–∫–ª—é—á–∞—é –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –∏ –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—é—Å—å", {"GELIODOR": 0.6, "CITRIN": 0.2}),
            AnswerOption("–í–∫–ª—é—á–∞—é—Å—å, –º–æ–≥—É ¬´–≤–∑—è—Ç—å –≤–ª–∞—Å—Ç—å¬ª –≤ —Å–∏—Ç—É–∞—Ü–∏–∏", {"GRANAT": 0.6, "CITRIN": 0.2}),
        ],
        multi=True
    ))

    return q


# ============================
# –ë–ª–æ–∫ 3 ‚Äî —Å—Ç–æ–ª–±—Ü—ã: –í–ê–£/–ü—Ä–æ—Ü–µ—Å—Å/–†–µ–∑—É–ª—å—Ç–∞—Ç (15 –≤–æ–ø—Ä–æ—Å–æ–≤)
# ============================

def build_block3_questions() -> List[Question]:
    q: List[Question] = []

    def Q(_id: str, group: str, text: str, options: List[AnswerOption], multi: bool = True) -> Question:
        return Question(id=_id, block=3, group=group, text=text, allow_multiple=multi, options=options)

    # c1: –í–ê–£ / –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ
    q.append(Q("c1_q1", "c1", "1) –ß—Ç–æ –≤ –ª—é–¥—è—Ö –≤—ã–∑—ã–≤–∞–µ—Ç —É —Ç–µ–±—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π ¬´–≤–∞—É¬ª? (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)",
               [
                   AnswerOption("–§–∏–∑–∏—á–µ—Å–∫–∞—è —Å–∏–ª–∞, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å, –≤–ª–∞–¥–µ–Ω–∏–µ —Ç–µ–ª–æ–º", {"SHUNGIT": 1.0}, tags=["sport"]),
                   AnswerOption("–ì–ª—É–±–æ–∫–∏–µ –º—ã—Å–ª–∏, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", {"AMETIST": 1.0}, tags=["thinking"]),
                   AnswerOption("–ö—Ä–∞—Å–∏–≤—ã–π –≥–æ–ª–æ—Å, –ø–æ–¥–∞—á–∞, –º–∞–Ω–µ—Ä–∞ –≥–æ–≤–æ—Ä–∏—Ç—å", {"GELIODOR": 1.0}, tags=["network"]),
                   AnswerOption("–•–∞—Ä–∏–∑–º–∞, —ç–º–æ—Ü–∏–∏, —É–º–µ–Ω–∏–µ –∑–∞–∂–µ—á—å", {"GRANAT": 1.0}, tags=["stage"]),
                   AnswerOption("–°–∏—Å—Ç–µ–º–∞, –ø—Ä–æ–¥—É–º–∞–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ä—è–¥–æ–∫", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/—Å—Ç–∏–ª—å/—ç—Å—Ç–µ—Ç–∏–∫–∞", {"IZUMRUD": 1.0}, tags=["beauty"]),
                   AnswerOption("–°–º–µ–ª–æ—Å—Ç—å, —Ä–∏—Å–∫, —à–∞–≥ –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç—å", {"RUBIN": 1.0}, tags=["adrenaline"]),
                   AnswerOption("–£–º–µ–Ω–∏–µ –¥–µ–ª–∞—Ç—å –¥–µ–Ω—å–≥–∏/—Ä–µ–∑—É–ª—å—Ç–∞—Ç", {"CITRIN": 1.0}, tags=["money"]),
               ], multi=True))

    q.append(Q("c1_q2", "c1", "2) –ö–∞–∫–∏–µ —Å—Ü–µ–Ω—ã/–∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ç–µ–±—è –∑–∞–≤–æ—Ä–∞–∂–∏–≤–∞—é—Ç?",
               [
                   AnswerOption("–ü—Ä–∏—Ä–æ–¥–∞, –≤–æ–¥–∞, –≥–æ—Ä—ã, –æ–∫–µ–∞–Ω, –∑–∞–∫–∞—Ç—ã", {"IZUMRUD": 0.6, "SAPFIR": 0.4}, tags=["beauty"]),
                   AnswerOption("–ì–æ—Ä–æ–¥, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ª–∏–Ω–∏–∏, –º–æ—Å—Ç—ã, –≥–µ–æ–º–µ—Ç—Ä–∏—è", {"YANTAR": 0.6, "CITRIN": 0.4}, tags=["system"]),
                   AnswerOption("–õ–∏—Ü–∞ –ª—é–¥–µ–π, —ç–º–æ—Ü–∏–∏, —Ä–µ–∞–∫—Ü–∏–∏", {"GRANAT": 0.6, "GELIODOR": 0.4}, tags=["stage"]),
                   AnswerOption("–°–ø–æ—Ä—Ç/–¥–≤–∏–∂–µ–Ω–∏–µ/—Ç–∞–Ω–µ—Ü, —Ç–µ–ª–∞ –≤ –¥–∏–Ω–∞–º–∏–∫–µ", {"SHUNGIT": 0.6, "RUBIN": 0.4}, tags=["sport"]),
                   AnswerOption("–ö–∞–¥—Ä/—Å–≤–µ—Ç/—Ç–µ–Ω–∏/—ç—Å—Ç–µ—Ç–∏–∫–∞ –¥–µ—Ç–∞–ª–µ–π", {"IZUMRUD": 1.0}, tags=["beauty"]),
               ], multi=True))

    q.append(Q("c1_q3", "c1", "3) –í —Ñ–∏–ª—å–º–∞—Ö/–∫–Ω–∏–≥–∞—Ö —Ç–µ–±—è —Ü–µ–ø–ª—è–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ‚Ä¶",
               [
                   AnswerOption("–°–º—ã—Å–ª—ã/—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è/–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã", {"SAPFIR": 0.8, "AMETIST": 0.4}, tags=["meaning"]),
                   AnswerOption("–°—Ç—Ä–∞—Ç–µ–≥–∏—è/–ø–ª–∞–Ω/–∫–∞–∫ –≤—Å—ë –ø—Ä–æ–¥—É–º–∞–Ω–æ", {"AMETIST": 0.6, "YANTAR": 0.6}, tags=["thinking"]),
                   AnswerOption("–ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ/—ç–∫—à–µ–Ω/–±–æ—Ä—å–±–∞/—Ä–∏—Å–∫", {"RUBIN": 0.6, "SHUNGIT": 0.4}, tags=["adrenaline"]),
                   AnswerOption("–≠–º–æ—Ü–∏–∏/–¥—Ä–∞–º—ã/–ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è", {"GRANAT": 0.6, "GELIODOR": 0.4}, tags=["stage"]),
                   AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞ –º–∏—Ä–∞/–∫–∞—Ä—Ç–∏–Ω–∫–∞/–∫–æ—Å—Ç—é–º—ã", {"IZUMRUD": 0.8}, tags=["beauty"]),
               ], multi=True))

    q.append(Q("c1_q4", "c1", "4) –ß—Ç–æ –≤ –º–∏—Ä–µ –∫–∞–∂–µ—Ç—Å—è —Ç–µ–±–µ ¬´–º–∞–≥–∏—á–Ω—ã–º¬ª/–Ω–µ–æ–±—ä—è—Å–Ω–∏–º—ã–º?",
               [
                   AnswerOption("–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–æ–∑–≥/–ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ", {"AMETIST": 0.8, "SAPFIR": 0.2}, tags=["thinking"]),
                   AnswerOption("–ú—É–∑—ã–∫–∞/–≥–æ–ª–æ—Å/–∑–≤—É–∫ –∏ –≤–ª–∏—è–Ω–∏–µ", {"GELIODOR": 0.8}, tags=["network"]),
                   AnswerOption("–°–∏—Å—Ç–µ–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–µ–Ω—è—é—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å", {"YANTAR": 0.8, "CITRIN": 0.2}, tags=["system"]),
                   AnswerOption("–ö–∞–∫ –æ–¥–Ω–æ —Å–º–µ–ª–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –º–µ–Ω—è–µ—Ç –∂–∏–∑–Ω—å", {"RUBIN": 0.8}, tags=["adrenaline"]),
                   AnswerOption("–ü—Ä–∏—Ä–æ–¥–∞/—Ü–∏–∫–ª—ã/–∫—Ä–∞—Å–æ—Ç–∞ –º–∏—Ä–∞", {"IZUMRUD": 0.6, "SAPFIR": 0.2}, tags=["beauty"]),
                   AnswerOption("–°–º—ã—Å–ª/—Å—É–¥—å–±–∞/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—É—Ç—å", {"SAPFIR": 0.8}, tags=["meaning"]),
               ], multi=True))

    q.append(Q("c1_q5", "c1", "5) –ß—Ç–æ —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ö/—Å—Ç—É–ø–æ—Ä/–∏–∑–±–µ–≥–∞–Ω–∏–µ?",
               [
                   AnswerOption("–ì—Ä–æ–º–∫–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Å–∏–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –ª—é–¥–µ–π", {"GRANAT": 0.3}, tags=["stage"]),
                   AnswerOption("–•–∞–æ—Å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∏ —è—Å–Ω–æ—Å—Ç–∏", {"YANTAR": 0.6}, tags=["system"]),
                   AnswerOption("–ë–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç—å, –∫–æ–≥–¥–∞ –Ω–µ—Ç –ª–æ–≥–∏–∫–∏/¬´–∑–∞—á–µ–º¬ª", {"SAPFIR": 0.6, "AMETIST": 0.2}, tags=["meaning"]),
                   AnswerOption("–ë–æ–ª—å—à–∏–µ –¥–µ–Ω—å–≥–∏/–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", {"CITRIN": 0.4}, tags=["money"]),
                   AnswerOption("–†–∏—Å–∫/–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç—å", {"RUBIN": 0.3}, tags=["adrenaline"]),
                   AnswerOption("–°–∏–ª—å–Ω–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞/–±–æ–ª—å/—Ç—Ä–∞–≤–º–∞", {"SHUNGIT": 0.3}, tags=["sport"]),
               ], multi=True))

    # c2: –ü—Ä–æ—Ü–µ—Å—Å / –º–æ—Ç–∏–≤–∞—Ü–∏—è
    q.append(Q("c2_q1", "c2", "6) –ö–∞–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è –≤—Ç—è–≥–∏–≤–∞—é—Ç —Ç–∞–∫, —á—Ç–æ —Ç—ã –∑–∞–±—ã–≤–∞–µ—à—å –ø—Ä–æ –≤—Ä–µ–º—è?",
               [
                   AnswerOption("–†–∞–∑–≥–æ–≤–æ—Ä—ã/–Ω–µ—Ç–≤–æ—Ä–∫/–æ–±—É—á–µ–Ω–∏–µ/–æ–±—ä—è—Å–Ω—è—Ç—å", {"GELIODOR": 1.0}, tags=["network"]),
                   AnswerOption("–ê–Ω–∞–ª–∏–∑/—Ä–∞–∑–±–æ—Ä/—Å–º—ã—Å–ª—ã", {"AMETIST": 0.8, "SAPFIR": 0.2}, tags=["thinking"]),
                   AnswerOption("–ü–æ—Ä—è–¥–æ–∫/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞/—á–∏–Ω–∏—Ç—å/–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–ó–∞–∫—Ä—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç/—Å–¥–µ–ª–∫–∏/–¥–æ–∂–∏–º", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏/–¥–≤–∏–∂–µ–Ω–∏–µ", {"SHUNGIT": 1.0}, tags=["sport"]),
                   AnswerOption("–î—Ä–∞–π–≤/–Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫", {"RUBIN": 1.0}, tags=["adrenaline"]),
                   AnswerOption("–í–∏–∑—É–∞–ª/–∫—Ä–∞—Å–æ—Ç–∞/–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞", {"IZUMRUD": 1.0}, tags=["beauty"]),
               ], multi=True))

    q.append(Q("c2_q2", "c2", "7) –ß—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å ¬´–¥–ª—è –¥—É—à–∏¬ª, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –æ—Ü–µ–Ω–∏—Ç?",
               [
                   AnswerOption("–£–±–∏—Ä–∞—Ç—å—Å—è/–æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–°–ø–æ—Ä—Ç/—Ä–∞—Å—Ç—è–∂–∫–∞/—É—Ö–æ–¥ –∑–∞ —Ç–µ–ª–æ–º", {"SHUNGIT": 0.8}, tags=["sport"]),
                   AnswerOption("–†–∞–∑–≥–æ–≤–æ—Ä—ã/–æ–±—É—á–µ–Ω–∏–µ/–ø–æ–º–æ—â—å –ª—é–¥—è–º", {"GELIODOR": 0.8, "SAPFIR": 0.2}, tags=["network"]),
                   AnswerOption("–ü–∏—Å–∞—Ç—å/–¥—É–º–∞—Ç—å/—Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Å–µ–±–µ", {"AMETIST": 0.6, "SAPFIR": 0.4}, tags=["thinking"]),
                   AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/–¥–µ—Ç–∞–ª–∏/—ç—Å—Ç–µ—Ç–∏–∫–∞ –¥–æ–º–∞", {"IZUMRUD": 0.8}, tags=["beauty"]),
                   AnswerOption("–î–≤–∏–∂/–ø–ª–∞–Ω—ã/–ø–æ–µ–∑–¥–∫–∏/–Ω–æ–≤–æ–µ", {"RUBIN": 0.8}, tags=["adrenaline"]),
               ], multi=True))

    q.append(Q("c2_q3", "c2", "8) –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±–æ—Ä, —Ç—ã –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–µ—à—å –∑–∞–¥–∞—á–∏ —Ç–∏–ø–∞‚Ä¶",
               [
                   AnswerOption("–ü—Ä–æ –ª—é–¥–µ–π: —Å–æ–∑–≤–æ–Ω/–≤—Å—Ç—Ä–µ—á–∞/–æ–±—É—á–µ–Ω–∏–µ", {"GELIODOR": 1.0}, tags=["network"]),
                   AnswerOption("–ü—Ä–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –ø–ª–∞–Ω/—Ç–∞–±–ª–∏—Ü–∞/—á–µ–∫-–ª–∏—Å—Ç", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–ü—Ä–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –∑–∞–∫—Ä—ã—Ç—å/–¥–æ–∂–∞—Ç—å/–ø—Ä–æ–¥–∞—Ç—å", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–ü—Ä–æ –∞–Ω–∞–ª–∏–∑: –ø–æ–Ω—è—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å", {"AMETIST": 1.0}, tags=["thinking"]),
                   AnswerOption("–ü—Ä–æ —Ç–µ–ª–æ: –ø–æ–µ—Ö–∞—Ç—å/–ø—Ä–∏–≤–µ–∑—Ç–∏/—Å–¥–µ–ª–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏", {"SHUNGIT": 0.6, "RUBIN": 0.4}, tags=["sport"]),
                   AnswerOption("–ü—Ä–æ –¥—Ä–∞–π–≤: –Ω–æ–≤–æ–µ/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫/–¥–≤–∏–∂", {"RUBIN": 1.0}, tags=["adrenaline"]),
               ], multi=True))

    q.append(Q("c2_q4", "c2", "9) –°–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–Ω—å –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ ‚Äî —Ç—ã —Å–∫–æ—Ä–µ–µ‚Ä¶",
               [
                   AnswerOption("–°–ø–æ—Ä—Ç/–ø—Ä–æ–≥—É–ª–∫–∞/–≥–æ—Ä—ã/–¥–≤–∏–∂–µ–Ω–∏–µ", {"SHUNGIT": 0.8, "RUBIN": 0.2}, tags=["sport"]),
                   AnswerOption("–ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫/–∑–∞–∫—Ä—ã—Ç—å –º–µ–ª–æ—á–∏/—Ä–∞–∑–æ–±—Ä–∞—Ç—å", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–í—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –ª—é–¥—å–º–∏/–æ–±—â–µ–Ω–∏–µ/–Ω–µ—Ç–≤–æ—Ä–∫", {"GELIODOR": 1.0}, tags=["network"]),
                   AnswerOption("–ü–æ—Å—á–∏—Ç–∞—Ç—å –ø–ª–∞–Ω—ã/–¥–µ–Ω—å–≥–∏/—Ü–µ–ª–∏", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–î—Ä–∞–π–≤/–ø–æ–µ–∑–¥–∫–∞/–Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ", {"RUBIN": 1.0}, tags=["adrenaline"]),
                   AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞/—ç—Å—Ç–µ—Ç–∏–∫–∞", {"IZUMRUD": 1.0}, tags=["beauty"]),
                   AnswerOption("–†–∞–∑–º—ã—à–ª—è—Ç—å/—á–∏—Ç–∞—Ç—å/—Å–º—ã—Å–ª—ã", {"AMETIST": 0.6, "SAPFIR": 0.4}, tags=["thinking"]),
               ], multi=True))

    q.append(Q("c2_q5", "c2", "10) –í —Ä–∞–±–æ—Ç–µ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å‚Ä¶",
               [
                   AnswerOption("–û–±—ä—è—Å–Ω—è—Ç—å/–æ–±—É—á–∞—Ç—å/—Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç–æ", {"GELIODOR": 0.8, "YANTAR": 0.2}, tags=["network"]),
                   AnswerOption("–°—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É/–ø—Ä–æ—Ü–µ—Å—Å/—Ä–µ–≥–ª–∞–º–µ–Ω—Ç", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–î–æ–∂–∏–º–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç/—Å–¥–µ–ª–∫–∏/—Ü–∏—Ñ—Ä—ã", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ª—é–¥–µ–π/–±—ã—Ç—å —Å–≤—è–∑—É—é—â–∏–º", {"GELIODOR": 0.8, "RUBIN": 0.2}, tags=["network"]),
                   AnswerOption("–ê–Ω–∞–ª–∏–∑/—Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", {"AMETIST": 1.0}, tags=["thinking"]),
                   AnswerOption("–ü–æ–ª–µ–≤—ã–µ –∑–∞–¥–∞—á–∏/–¥–≤–∏–∂–µ–Ω–∏–µ", {"SHUNGIT": 0.6, "RUBIN": 0.4}, tags=["sport"]),
               ], multi=True))

    # c3: –†–µ–∑—É–ª—å—Ç–∞—Ç / —Ç—Ä–∏—É–º—Ñ
    q.append(Q("c3_q1", "c3", "11) –ö–∞–∫–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç—ã —Ä–µ–∞–ª—å–Ω–æ –≥–æ—Ä–¥–∏—à—å—Å—è?",
               [
                   AnswerOption("–î–µ–Ω—å–≥–∏/—Å–¥–µ–ª–∫–∏/—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–°–ø–æ—Ä—Ç/—Ç–µ–ª–æ/–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å", {"SHUNGIT": 1.0}, tags=["sport"]),
                   AnswerOption("–°–∏—Å—Ç–µ–º–∞/–ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –º–µ–Ω—è", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–õ—é–¥–∏: –ø–æ–º–æ–≥, –æ–±—É—á–∏–ª, –∏–∑–º–µ–Ω–∏–ª –º—ã—à–ª–µ–Ω–∏–µ", {"GELIODOR": 0.8, "SAPFIR": 0.2}, tags=["network"]),
                   AnswerOption("–°–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è/–∏–Ω—Å–∞–π—Ç—ã/–ø–æ–≤–æ—Ä–æ—Ç—ã", {"AMETIST": 0.8, "SAPFIR": 0.2}, tags=["thinking"]),
                   AnswerOption("–ó–∞–ø—É—Å–∫/—Å–æ–±—ã—Ç–∏–µ/–ø—Ä–æ–µ–∫—Ç —Å –¥—Ä–∞–π–≤–æ–º", {"RUBIN": 1.0}, tags=["adrenaline"]),
                   AnswerOption("–ö—Ä–∞—Å–∏–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç/–≤–∏–∑—É–∞–ª/–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", {"IZUMRUD": 1.0}, tags=["beauty"]),
               ], multi=True))

    q.append(Q("c3_q2", "c3", "12) –°–∞–º—ã–π ¬´—Å–ª–∞–¥–∫–∏–π –º–æ–º–µ–Ω—Ç¬ª –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è —Ç–µ–±—è ‚Äî –∫–æ–≥–¥–∞‚Ä¶",
               [
                   AnswerOption("–í–∏–∂—É —Ü–∏—Ñ—Ä—ã/—Ä–µ–∑—É–ª—å—Ç–∞—Ç/–¥–µ–Ω—å–≥–∏", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–í—Å—ë —Å–æ–±—Ä–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –º–µ—Ö–∞–Ω–∏–∑–º", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–¢–µ–ª–æ –ø—Ä–∏—è—Ç–Ω–æ —É—Å—Ç–∞–ª–æ, —á—É–≤—Å—Ç–≤—É—é —Å–∏–ª—É", {"SHUNGIT": 1.0}, tags=["sport"]),
                   AnswerOption("–ü—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç–∫–ª–∏–∫ –ª—é–¥–µ–π/—Ä–µ–∞–∫—Ü–∏–∏/—ç–º–æ—Ü–∏–∏", {"GRANAT": 0.6, "GELIODOR": 0.4}, tags=["stage"]),
                   AnswerOption("–ü–æ–Ω–∏–º–∞—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–æ—Å—Ç/—Å–¥–≤–∏–≥", {"SAPFIR": 0.8, "AMETIST": 0.2}, tags=["meaning"]),
                   AnswerOption("–ü—Ä–æ–µ–∫—Ç –≤—ã—Ö–æ–¥–∏—Ç –≤ –º–∏—Ä/–∑–∞–ø—É—Å–∫/—Å–æ–±—ã—Ç–∏–µ", {"RUBIN": 0.6, "GRANAT": 0.4}, tags=["adrenaline"]),
               ], multi=True))

    q.append(Q("c3_q3", "c3", "13) –ß—Ç–æ –¥–∞—ë—Ç –æ—â—É—â–µ–Ω–∏–µ ¬´—è —Ä–µ–∞–ª—å–Ω–æ –º–æ–ª–æ–¥–µ—Ü¬ª?",
               [
                   AnswerOption("–ó–∞–∫—Ä—ã–ª(–∞) —Å–¥–µ–ª–∫—É/–ø—Ä–æ–µ–∫—Ç –∏ –ø—Ä–∏–Ω—ë—Å(–ª–∞) –¥–µ–Ω—å–≥–∏", {"CITRIN": 1.0}, tags=["money"]),
                   AnswerOption("–ö–æ–º—É-—Ç–æ –ø–æ–º–æ–≥/–ø–æ–¥–¥–µ—Ä–∂–∞–ª/–æ–±—É—á–∏–ª", {"GELIODOR": 0.8, "SAPFIR": 0.2}, tags=["network"]),
                   AnswerOption("–†–µ—à–∏–ª —Å–ª–æ–∂–Ω—É—é –∑–∞–¥–∞—á—É, –≥–¥–µ –¥—Ä—É–≥–∏–µ –∑–∞—Å—Ç—Ä—è–ª–∏", {"AMETIST": 0.8, "YANTAR": 0.2}, tags=["thinking"]),
                   AnswerOption("–°–¥–µ–ª–∞–ª –æ—á–µ–Ω—å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ/–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ/–ø–æ –ø—Ä–∞–≤–∏–ª–∞–º", {"YANTAR": 1.0}, tags=["system"]),
                   AnswerOption("–í—ã–∏–≥—Ä–∞–ª —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ/–∫–æ–Ω–∫—É—Ä—Å/–ø–µ—Ä–≤–µ–Ω—Å—Ç–≤–æ", {"CITRIN": 0.8, "SHUNGIT": 0.2}, tags=["sport"]),
                   AnswerOption("–°–¥–µ–ª–∞–ª –∫—Ä–∞—Å–∏–≤–æ/—ç—Å—Ç–µ—Ç–∏—á–Ω–æ", {"IZUMRUD": 1.0}, tags=["beauty"]),
               ], multi=True))

    q.append(Q("c3_q4", "c3", "14) –ö–æ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è ¬´–±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º¬ª –∏ —Ç—ã –±–æ—Ä–µ—à—å—Å—è –¥–æ –∫–æ–Ω—Ü–∞?",
               [
                   AnswerOption("–ó–∞—â–∏—Ç–∏—Ç—å —Å–µ–º—å—é/–∫–æ–º–∞–Ω–¥—É", {"YANTAR": 0.4, "CITRIN": 0.4, "SAPFIR": 0.2}, tags=["meaning"]),
                   AnswerOption("–ñ—ë—Å—Ç–∫–∏–π –¥–µ–¥–ª–∞–π–Ω ‚Äî –¥–æ–¥–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç", {"CITRIN": 0.8, "YANTAR": 0.2}, tags=["money"]),
                   AnswerOption("–ù–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å ‚Äî –¥–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–¥—É", {"AMETIST": 0.6, "RUBIN": 0.4}, tags=["adrenaline"]),
                   AnswerOption("–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã/—Ç–æ—Ä–≥ ‚Äî –æ—Ç—Å—Ç–æ—è—Ç—å —É—Å–ª–æ–≤–∏—è", {"CITRIN": 0.8}, tags=["money"]),
                   AnswerOption("–ü–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º –≤ —ç—Ñ–∏—Ä/–ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å", {"GRANAT": 0.6, "GELIODOR": 0.4}, tags=["stage"]),
                   AnswerOption("–í —Ä–∏—Å–∫-—Å–∏—Ç—É–∞—Ü–∏–∏/—ç–∫—Å—Ç—Ä–∏–º/–∫—Ä–∏–∑–∏—Å", {"RUBIN": 0.8, "SHUNGIT": 0.2}, tags=["adrenaline"]),
               ], multi=True))

    q.append(Q("c3_q5", "c3", "15) –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ç–∏–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∂–∏–∑–Ω–∏ ‚Äî —á—Ç–æ –≤—ã–±–∏—Ä–∞–µ—à—å? (1 –≤–∞—Ä–∏–∞–Ω—Ç)",
               [
                   AnswerOption("–¢–µ–ª–æ/—Å–∏–ª–∞/–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å/—Å–ø–æ—Ä—Ç", {"SHUNGIT": 1.2}, tags=["sport"]),
                   AnswerOption("–§–∏–Ω–∞–Ω—Å—ã/—Å—Ç–∞—Ç—É—Å/–±–∏–∑–Ω–µ—Å-—Ä–µ–∑—É–ª—å—Ç–∞—Ç", {"CITRIN": 1.2}, tags=["money"]),
                   AnswerOption("–°–∏—Å—Ç–µ–º—ã/–Ω–∞—Å–ª–µ–¥–∏–µ/–ø—Ä–æ—Ü–µ—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç", {"YANTAR": 1.2}, tags=["system"]),
                   AnswerOption("–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ª—é–¥–µ–π/–æ–±—É—á–µ–Ω–∏–µ/—Å–≤—è–∑–∏", {"GELIODOR": 1.0, "GRANAT": 0.2}, tags=["network"]),
                   AnswerOption("–°–º—ã—Å–ª/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—É—Ç—å/–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å", {"SAPFIR": 1.2}, tags=["meaning"]),
                   AnswerOption("–î—Ä–∞–π–≤/–Ω–æ–≤–∞—è –∂–∏–∑–Ω—å/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏", {"RUBIN": 1.2}, tags=["adrenaline"]),
                   AnswerOption("–ö—Ä–∞—Å–æ—Ç–∞/–≥–∞—Ä–º–æ–Ω–∏—è/—ç—Å—Ç–µ—Ç–∏–∫–∞ –º–∏—Ä–∞", {"IZUMRUD": 1.2}, tags=["beauty"]),
                   AnswerOption("–ì–ª—É–±–∏–Ω–∞/–º—ã—à–ª–µ–Ω–∏–µ/–∏–Ω—Å–∞–π—Ç—ã", {"AMETIST": 1.2}, tags=["thinking"]),
               ], multi=False))

    return q


# ============================
# –î–≤–∏–∂–æ–∫ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è (1 –≤–æ–ø—Ä–æ—Å = 1 —ç–∫—Ä–∞–Ω)
# ============================

def init_state():
    if "initialized" in st.session_state:
        return

    st.session_state.initialized = True

    st.session_state.mode = "client"  # client/master

    # client profile
    st.session_state.client_name = ""
    st.session_state.client_contact = ""

    # block1
    st.session_state.b1_questions = build_block1_questions()
    st.session_state.b1_scores = {p: 0.0 for p in POTENTIALS}
    st.session_state.b1_answers: Dict[str, Any] = {}
    st.session_state.b1_core_index = 0
    st.session_state.b1_injected_queue: List[str] = []
    st.session_state.b1_current_qid = CORE_SEQUENCE_BLOCK1[0]
    st.session_state.b1_done = False

    # block2
    st.session_state.b2_questions = build_block2_questions()
    st.session_state.b2_scores = {p: 0.0 for p in POTENTIALS}
    st.session_state.b2_answers: Dict[str, Any] = {}
    st.session_state.b2_index = 0
    st.session_state.b2_done = False

    # block3
    st.session_state.b3_questions = build_block3_questions()
    st.session_state.b3_scores_total = {p: 0.0 for p in POTENTIALS}
    st.session_state.b3_scores_cols = {p: {"c1": 0.0, "c2": 0.0, "c3": 0.0} for p in POTENTIALS}
    st.session_state.b3_answers: Dict[str, Any] = {}
    st.session_state.b3_index = 0
    st.session_state.b3_done = False

    # progress
    st.session_state.current_block = 0  # 0=welcome,1,2,3,4=finish


def get_next_b1_question_id() -> Optional[str]:
    # injected first
    while st.session_state.b1_injected_queue:
        nxt = st.session_state.b1_injected_queue.pop(0)
        if nxt not in st.session_state.b1_answers:
            return nxt

    # then core
    while True:
        st.session_state.b1_core_index += 1
        if st.session_state.b1_core_index >= len(CORE_SEQUENCE_BLOCK1):
            return None
        cand = CORE_SEQUENCE_BLOCK1[st.session_state.b1_core_index]
        if cand not in st.session_state.b1_answers:
            return cand


def apply_b1_answer(question: Question, selected_indices: List[int], comment: str, deep: Optional[Dict[str, Any]]):
    # save
    selected_texts = [question.options[i].text for i in selected_indices]
    st.session_state.b1_answers[question.id] = {
        "question": question.text,
        "selected": selected_texts,
        "comment": (comment or "").strip(),
        "deep": deep or None,
    }

    # score + inject
    for idx in selected_indices:
        opt = question.options[idx]
        apply_score(st.session_state.b1_scores, opt.score_changes)
        for qid in opt.inject_questions:
            if qid not in st.session_state.b1_answers and qid not in st.session_state.b1_injected_queue:
                st.session_state.b1_injected_queue.append(qid)

    # deep probe scoring (–º—è–≥–∫–æ)
    if deep:
        m = deep.get("motive")
        l = deep.get("lack")
        if m in MOTIVE_TO_POT:
            apply_score(st.session_state.b1_scores, MOTIVE_TO_POT[m])
        if l in LACK_TO_HINT:
            apply_score(st.session_state.b1_scores, LACK_TO_HINT[l])

    nxt = get_next_b1_question_id()
    st.session_state.b1_current_qid = nxt
    if nxt is None:
        st.session_state.b1_done = True


def apply_b2_answer(question: Question, selected_indices: List[int], comment: str, deep: Optional[Dict[str, Any]]):
    selected_texts = [question.options[i].text for i in selected_indices]
    st.session_state.b2_answers[question.id] = {
        "question": question.text,
        "selected": selected_texts,
        "comment": (comment or "").strip(),
        "deep": deep or None,
    }

    for idx in selected_indices:
        opt = question.options[idx]
        apply_score(st.session_state.b2_scores, opt.score_changes)

    if deep:
        m = deep.get("motive")
        l = deep.get("lack")
        if m in MOTIVE_TO_POT:
            apply_score(st.session_state.b2_scores, MOTIVE_TO_POT[m])
        if l in LACK_TO_HINT:
            apply_score(st.session_state.b2_scores, LACK_TO_HINT[l])

    st.session_state.b2_index += 1
    if st.session_state.b2_index >= len(st.session_state.b2_questions):
        st.session_state.b2_done = True


def apply_b3_answer(question: Question, selected_indices: List[int], comment: str, deep: Dict[str, Any]):
    selected_texts = [question.options[i].text for i in selected_indices]
    st.session_state.b3_answers[question.id] = {
        "question": question.text,
        "selected": selected_texts,
        "comment": (comment or "").strip(),
        "deep": deep or None,
        "group": question.group,
    }

    # base score per selected option
    for idx in selected_indices:
        opt = question.options[idx]
        apply_score(st.session_state.b3_scores_total, opt.score_changes)
        for pot, delta in opt.score_changes.items():
            if pot in st.session_state.b3_scores_cols:
                st.session_state.b3_scores_cols[pot][question.group] += float(delta)

    # deep probe: apply within same column too
    if deep:
        m = deep.get("motive")
        l = deep.get("lack")
        if m in MOTIVE_TO_POT:
            apply_score(st.session_state.b3_scores_total, MOTIVE_TO_POT[m])
            for pot, delta in MOTIVE_TO_POT[m].items():
                if pot in st.session_state.b3_scores_cols:
                    st.session_state.b3_scores_cols[pot][question.group] += float(delta)
        if l in LACK_TO_HINT:
            apply_score(st.session_state.b3_scores_total, LACK_TO_HINT[l])
            for pot, delta in LACK_TO_HINT[l].items():
                if pot in st.session_state.b3_scores_cols:
                    st.session_state.b3_scores_cols[pot][question.group] += float(delta)

    st.session_state.b3_index += 1
    if st.session_state.b3_index >= len(st.session_state.b3_questions):
        st.session_state.b3_done = True


def combined_total_scores() -> Dict[str, float]:
    out = {p: 0.0 for p in POTENTIALS}
    for p in POTENTIALS:
        out[p] += float(st.session_state.b1_scores.get(p, 0.0))
        out[p] += float(st.session_state.b2_scores.get(p, 0.0))
        out[p] += float(st.session_state.b3_scores_total.get(p, 0.0))
    return out


def best_column_for_pot(pot: str, col_scores: Dict[str, Dict[str, float]]) -> str:
    cols = col_scores.get(pot, {"c1": 0.0, "c2": 0.0, "c3": 0.0})
    return max(cols.keys(), key=lambda c: cols[c])


def assign_row_to_columns(row_pots: List[str], col_scores: Dict[str, Dict[str, float]]) -> Dict[str, str]:
    """
    row_pots: 3 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç mapping: {"c1": pot, "c2": pot, "c3": pot}
    –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫—É, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—é—â—É—é —Å—É–º–º—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫.
    """
    cols = ["c1", "c2", "c3"]
    best_map = None
    best_sum = -1e9
    for perm in itertools.permutations(row_pots, 3):
        s = 0.0
        for c, pot in zip(cols, perm):
            s += float(col_scores.get(pot, {}).get(c, 0.0))
        if s > best_sum:
            best_sum = s
            best_map = dict(zip(cols, perm))
    return best_map or {"c1": row_pots[0], "c2": row_pots[1], "c3": row_pots[2]}


def build_3x3_table(row1: List[str], row2: List[str], row3: List[str], col_scores: Dict[str, Dict[str, float]]) -> List[List[str]]:
    m1 = assign_row_to_columns(row1, col_scores)
    m2 = assign_row_to_columns(row2, col_scores)
    m3 = assign_row_to_columns(row3, col_scores)
    # rows: [c1,c2,c3]
    return [
        [m1["c1"], m1["c2"], m1["c3"]],
        [m2["c1"], m2["c2"], m2["c3"]],
        [m3["c1"], m3["c2"], m3["c3"]],
    ]


# ============================
# UI: –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –ø–æ—Ç–æ–∫
# ============================

def render_welcome():
    st.title("Deep Identity ¬∑ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤")
    st.write("–û—Ç–≤–µ—Ç—å —á–µ—Å—Ç–Ω–æ. –ó–¥–µ—Å—å –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –µ—Å—Ç—å —Ç–≤–æ—è –ø—Ä–∏—Ä–æ–¥–∞.")
    st.info("‚ö†Ô∏è –û—Ç—á—ë—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä. –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å—ã –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω ¬´–°–ø–∞—Å–∏–±–æ¬ª.")

    st.markdown("### –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? (—á—Ç–æ–±—ã –≤ –æ—Ç—á—ë—Ç–µ –±—ã–ª–æ –∏–º—è)")
    st.session_state.client_name = st.text_input("–ò–º—è", value=st.session_state.client_name, placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù—É—Ä–ª–∞–Ω")

    st.markdown("### –ö–æ–Ω—Ç–∞–∫—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)")
    st.session_state.client_contact = st.text_input("–¢–µ–ª–µ–≥—Ä–∞–º / email", value=st.session_state.client_contact, placeholder="@username –∏–ª–∏ email")

    if st.button("–ù–∞—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É"):
        st.session_state.current_block = 1
        st.rerun()


def render_question_screen(question: Question, total_progress: Tuple[int, int], block_title: str, group_caption: str = ""):
    done, total = total_progress
    st.progress(min(1.0, done / max(1, total)))
    st.subheader(block_title)
    if group_caption:
        st.caption(group_caption)

    st.markdown(f"### {question.text}")

    labels = [o.text for o in question.options]

    selected_indices: List[int] = []
    if question.allow_multiple:
        chosen = st.multiselect("–í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:", options=labels, key=f"sel_{question.id}")
        selected_indices = [labels.index(x) for x in chosen] if chosen else []
    else:
        chosen = st.radio("–í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç:", options=["‚Äî –Ω–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî"] + labels, key=f"sel_{question.id}")
        if chosen != "‚Äî –Ω–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî":
            selected_indices = [labels.index(chosen)]

    comment = ""
    if question.allow_comment:
        comment = st.text_area("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π/–ø—Ä–∏–º–µ—Ä (–ø–æ –∂–µ–ª–∞–Ω–∏—é, –Ω–æ –æ—á–µ–Ω—å –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):", key=f"comm_{question.id}", height=90)

    # –£–≥–ª—É–±–ª–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞, –Ω–æ –º–æ–∂–Ω–æ —Å–≤–µ—Ä–Ω—É—Ç—å
    with st.expander("üîé –£–≥–ª—É–±–∏—Ç—å—Å—è: ¬´–ø–æ—á–µ–º—É?¬ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)"):
        deep = render_deep_probe(question.id, group_for_block3=(question.group if question.block == 3 else None))
    # –∏–Ω–∞—á–µ deep –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω (radio), —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

    can_next = bool(selected_indices) or bool((comment or "").strip())
    st.write("")
    col1, col2 = st.columns([1, 2])
    with col1:
        if st.button("–î–∞–ª—å—à–µ ‚ûú", disabled=not can_next, key=f"next_{question.id}"):
            if question.block == 1:
                apply_b1_answer(question, selected_indices, comment, deep)
                st.rerun()
            elif question.block == 2:
                apply_b2_answer(question, selected_indices, comment, deep)
                st.rerun()
            else:
                apply_b3_answer(question, selected_indices, comment, deep)
                st.rerun()
    with col2:
        st.caption("–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –≤—ã–±–∏—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –Ω–∞–ø–∏—à–∏ —Ö–æ—Ç—è –±—ã 1‚Äì2 —Å—Ç—Ä–æ–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è. –≠—Ç–æ —Ç–æ–∂–µ —Å–∏–≥–Ω–∞–ª.")


def render_block1():
    qid = st.session_state.b1_current_qid
    if qid is None or st.session_state.b1_done:
        st.session_state.current_block = 2
        st.rerun()

    q = st.session_state.b1_questions[qid]
    # –ø—Ä–æ–≥—Ä–µ—Å—Å (–æ—Ü–µ–Ω–∫–∞)
    answered = len(st.session_state.b1_answers)
    approx_total = len(CORE_SEQUENCE_BLOCK1) + 6
    render_question_screen(
        q,
        total_progress=(answered, approx_total),
        block_title="–ë–ª–æ–∫ 1 ¬∑ –î–µ—Ç—Å—Ç–≤–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç–∏",
        group_caption="–ú—ã –∏—â–µ–º —á–∏—Å—Ç—É—é –º–æ—Ç–∏–≤–∞—Ü–∏—é –¥–æ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–∞—Å–æ–∫."
    )


def render_block2():
    if st.session_state.b2_done:
        st.session_state.current_block = 3
        st.rerun()

    idx = st.session_state.b2_index
    q_list = st.session_state.b2_questions
    q = q_list[idx]
    render_question_screen(
        q,
        total_progress=(idx, len(q_list)),
        block_title="–ë–ª–æ–∫ 2 ¬∑ –†–∞–±–æ—Ç–∞, —Ä–æ–ª–∏, –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ —Å–º–µ—â–µ–Ω–∏—è",
        group_caption="–ó–¥–µ—Å—å –≤–∏–¥–Ω–æ: ¬´—è–¥—Ä–æ¬ª –∏–ª–∏ ¬´—Ä–æ–ª—å —Ä–∞–¥–∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π¬ª."
    )


def render_block3():
    if st.session_state.b3_done:
        st.session_state.current_block = 4
        st.rerun()

    idx = st.session_state.b3_index
    q_list = st.session_state.b3_questions
    q = q_list[idx]

    col_name = {"c1": "–°—Ç–æ–ª–±–µ—Ü 1 ¬∑ –í–æ—Å–ø—Ä–∏—è—Ç–∏–µ (–í–ê–£)",
                "c2": "–°—Ç–æ–ª–±–µ—Ü 2 ¬∑ –ü—Ä–æ—Ü–µ—Å—Å (–∏–Ω—Ç–µ—Ä–µ—Å/–ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ)",
                "c3": "–°—Ç–æ–ª–±–µ—Ü 3 ¬∑ –†–µ–∑—É–ª—å—Ç–∞—Ç (—Ç—Ä–∏—É–º—Ñ/–ø–æ–±–µ–¥–∞)"}[q.group]

    render_question_screen(
        q,
        total_progress=(idx, len(q_list)),
        block_title="–ë–ª–æ–∫ 3 ¬∑ –°—Ç–æ–ª–±—Ü—ã: –í–ê–£ ‚Üí –ü—Ä–æ—Ü–µ—Å—Å ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç",
        group_caption=col_name
    )


def render_finish_and_save():
    st.title("–°–ø–∞—Å–∏–±–æ! –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚úÖ")
    st.write("–¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ú–∞—Å—Ç–µ—Ä —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –æ—Ç–¥–µ–ª—å–Ω–æ.")

    total = combined_total_scores()
    top = sorted(total.items(), key=lambda x: x[1], reverse=True)

    st.markdown("### –¢–æ–ø-—Å–∏–≥–Ω–∞–ª—ã (—á–µ—Ä–Ω–æ–≤—ã–µ, –±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏)")
    for k, v in top[:5]:
        st.write(f"- **{POT_LABEL[k]}**: {round(v, 2)}")

    # save
    payload = {
        "id": str(uuid.uuid4()),
        "created_at": _now_iso(),
        "client_name": st.session_state.client_name.strip(),
        "client_contact": st.session_state.client_contact.strip(),
        "answers": {
            "block1": st.session_state.b1_answers,
            "block2": st.session_state.b2_answers,
            "block3": st.session_state.b3_answers,
        },
        "scores": {
            "block1": st.session_state.b1_scores,
            "block2": st.session_state.b2_scores,
            "block3_total": st.session_state.b3_scores_total,
            "block3_cols": st.session_state.b3_scores_cols,
            "combined_total": total,
        },
        "master_report": {
            "generated_at": None,
            "draft_text": "",
            "rows_override": None,
        },
    }

    # guard: –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ rerun
    if "saved_result_id" not in st.session_state:
        append_result(payload)
        st.session_state.saved_result_id = payload["id"]

    st.success("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ")

    # download client copy (–±–µ–∑ –æ—Ç—á—ë—Ç–∞)
    client_copy = {
        "id": payload["id"],
        "created_at": payload["created_at"],
        "client_name": payload["client_name"],
        "client_contact": payload["client_contact"],
        "answers": payload["answers"],
        "scores": payload["scores"],
    }
    st.download_button(
        "‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –º–æ–∏ –æ—Ç–≤–µ—Ç—ã (–∫–æ–ø–∏—è)",
        data=json.dumps(client_copy, ensure_ascii=False, indent=2).encode("utf-8"),
        file_name="deep_identity_my_answers.json",
        mime="application/json",
    )

    if st.button("–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ"):
        for k in list(st.session_state.keys()):
            del st.session_state[k]
        st.rerun()


# ============================
# –ú–∞—Å—Ç–µ—Ä-–ø–∞–Ω–µ–ª—å
# ============================

def master_auth_ok() -> bool:
    pwd_secret = None
    try:
        pwd_secret = st.secrets.get("MASTER_PASSWORD", None)
    except Exception:
        pwd_secret = None
    if not pwd_secret:
        pwd_secret = os.environ.get("MASTER_PASSWORD")

    st.sidebar.subheader("üîí –ú–∞—Å—Ç–µ—Ä-—Ä–µ–∂–∏–º")
    pwd = st.sidebar.text_input("–ü–∞—Ä–æ–ª—å –º–∞—Å—Ç–µ—Ä–∞", type="password")
    if not pwd_secret:
        st.sidebar.warning("MASTER_PASSWORD –Ω–µ –∑–∞–¥–∞–Ω –≤ Secrets. –î–æ–±–∞–≤—å –µ–≥–æ –≤ Streamlit Cloud.")
        return False
    return pwd == str(pwd_secret)


def format_session_title(item: Dict[str, Any]) -> str:
    name = item.get("client_name") or "–ë–µ–∑ –∏–º–µ–Ω–∏"
    created = item.get("created_at") or ""
    rid = item.get("id", "")[:8]
    return f"{name} ¬∑ {created} ¬∑ #{rid}"


def build_master_table_default(scores_combined: Dict[str, float], col_scores: Dict[str, Dict[str, float]]) -> Tuple[List[str], List[str], List[str], List[List[str]]]:
    ranked = [k for k, _ in sorted(scores_combined.items(), key=lambda x: x[1], reverse=True)]
    row1 = ranked[:3]
    row2 = ranked[3:6]
    row3 = ranked[6:9]
    table = build_3x3_table(row1, row2, row3, col_scores)
    return row1, row2, row3, table


def render_3x3_table(table: List[List[str]]):
    # table rows contain potential keys
    headers = ["–í–ê–£ (–≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ)", "–ü—Ä–æ—Ü–µ—Å—Å (–º–æ—Ç–∏–≤–∞—Ü–∏—è)", "–†–µ–∑—É–ª—å—Ç–∞—Ç (–¥–µ–π—Å—Ç–≤–∏–µ)"]
    rows = []
    for r in table:
        rows.append([POT_LABEL[r[0]], POT_LABEL[r[1]], POT_LABEL[r[2]]])

    st.markdown("### –¢–∞–±–ª–∏—Ü–∞ 3√ó3 (—Ä—è–¥—ã √ó —Å—Ç–æ–ª–±—Ü—ã)")
    st.table({"": ["–†—è–¥ 1 (—è–¥—Ä–æ)", "–†—è–¥ 2 (–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ/—Ö–æ–±–±–∏)", "–†—è–¥ 3 (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å/—Å–ª–∞–±–µ–µ)"],
              headers[0]: [rows[0][0], rows[1][0], rows[2][0]],
              headers[1]: [rows[0][1], rows[1][1], rows[2][1]],
              headers[2]: [rows[0][2], rows[1][2], rows[2][2]]})


def compose_report_prompt(session: Dict[str, Any], table: List[List[str]]) -> str:
    # —Å–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ + deep_text
    def extract_text(block_answers: Dict[str, Any]) -> str:
        chunks = []
        for qid, a in block_answers.items():
            chunks.append(f"[{qid}] {a.get('question','')}")
            sel = a.get("selected", [])
            if sel:
                for s in sel:
                    chunks.append(f"- –í—ã–±—Ä–∞–Ω–æ: {s}")
            c = (a.get("comment") or "").strip()
            if c:
                chunks.append(f"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {c}")
            deep = a.get("deep") or None
            if deep:
                motive = deep.get("motive")
                lack = deep.get("lack")
                dt = (deep.get("deep_text") or "").strip()
                if motive:
                    chunks.append(f"–ü–æ—á–µ–º—É(–º–æ—Ç–∏–≤): {motive}")
                if lack:
                    chunks.append(f"–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —á—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è: {lack}")
                if dt:
                    chunks.append(f"–ì–ª—É–±–∏–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä: {dt}")
            chunks.append("")
        return "\n".join(chunks)

    answers = session.get("answers", {})
    b1 = extract_text(answers.get("block1", {}))
    b2 = extract_text(answers.get("block2", {}))
    b3 = extract_text(answers.get("block3", {}))

    # —Ç–∞–±–ª–∏—Ü–∞ –∫–∞–∫ –∫–ª—é—á–∏ + —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    table_ru = [[POT_LABEL[x] for x in row] for row in table]

    prompt = f"""
–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–∞—Å—Ç–µ—Ä–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤ (—Å–∏—Å—Ç–µ–º–∞ 3√ó3: 3 —Ä—è–¥–∞ + 3 —Å—Ç–æ–ª–±—Ü–∞).
–í–∞–∂–Ω–æ: —ç—Ç–æ –ß–ï–†–ù–û–í–û–ô –æ—Ç—á—ë—Ç –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞. –ö–ª–∏–µ–Ω—Ç –µ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç.

–ü—Ä–∞–≤–∏–ª–∞:
- –ù–µ —Å–ø–æ—Ä—å —Å –º–∞—Å—Ç–µ—Ä–æ–º, –Ω–µ ¬´–ø—Å–∏—Ö–æ–ª–æ–≥–∏–∑–∏—Ä—É–π¬ª –±–µ–∑ –æ–ø–æ—Ä—ã.
- –û–ø–∏—Ä–∞–π—Å—è –Ω–∞ –æ—Ç–≤–µ—Ç—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ deep_text.
- –†—É–±–∏–Ω ‚Äî —ç—Ç–æ –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫/–Ω–æ–≤–∏–∑–Ω–∞/–ø–æ–µ–∑–¥–∫–∏/—Å–æ–±—ã—Ç–∏—è, –ù–ï ¬´—Å–ø–æ—Ä—Ç¬ª.
- –°–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –®—É–Ω–≥–∏—Ç (—Ç–µ–ª–æ/–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å), –¶–∏—Ç—Ä–∏–Ω (–ø–æ–±–µ–¥–∞/—Å–∫–æ—Ä–æ—Å—Ç—å/–ø–µ—Ä–≤–µ–Ω—Å—Ç–≤–æ), –†—É–±–∏–Ω (–¥—Ä–∞–π–≤/–∞–¥—Ä–µ–Ω–∞–ª–∏–Ω).
- –†—è–¥ 1 = —è–¥—Ä–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–∏–ª—å–Ω–µ–π—à–∏–µ –æ–ø–æ—Ä—ã).
- –†—è–¥ 2 = —Ä—è–¥ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è/—Ö–æ–±–±–∏/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
- –†—è–¥ 3 = —Å–ª–∞–±–µ–µ/–ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç/–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å/–¥–æ–∑–∏—Ä–æ–≤–∞—Ç—å.

–í–æ—Ç —Ç–∞–±–ª–∏—Ü–∞ 3√ó3 (–≤ —Ñ–æ—Ä–º–∞—Ç–µ: –†—è–¥1, –†—è–¥2, –†—è–¥3; —Å—Ç–æ–ª–±—Ü—ã: –í–ê–£/–ü—Ä–æ—Ü–µ—Å—Å/–†–µ–∑—É–ª—å—Ç–∞—Ç):
{json.dumps(table_ru, ensure_ascii=False)}

–ó–∞–¥–∞—á–∞:
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ—Ç—á—ë—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

1) –ö–æ—Ä–æ—Ç–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç (6‚Äì10 —Å—Ç—Ä–æ–∫).
2) –¢–∞–±–ª–∏—Ü–∞ 3√ó3 (–≤ —Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–π –∫—Ä–∞—Å–∏–≤–æ).
3) –ü–æ –∫–∞–∂–¥–æ–º—É –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—É –≤ —Ç–∞–±–ª–∏—Ü–µ:
   - –ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —É —á–µ–ª–æ–≤–µ–∫–∞ (–ø–æ –æ—Ç–≤–µ—Ç–∞–º).
   - –ì–ª–∞–≤–Ω–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å.
   - –ì–ª–∞–≤–Ω–∞—è –±–æ–ª—å/–ª–æ–≤—É—à–∫–∞.
   - –ß—Ç–æ –¥–µ–ª–∞—Ç—å (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏).
4) –î–µ–Ω—å–≥–∏/—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
   - 3‚Äì5 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –≥–¥–µ —á–µ–ª–æ–≤–µ–∫—É –ø—Ä–æ—â–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –∏—Å—Ö–æ–¥—è –∏–∑ —è–¥—Ä–∞ (—Ä—è–¥1).
   - –ö–∞–∫ –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –≤—ã–≥–æ—Ä–∞–Ω–∏—è (—É—á–∏—Ç—ã–≤–∞—è —Ä—è–¥2 –∏ —Ä—è–¥3).
5) –≠–Ω–µ—Ä–≥–∏—è:
   - –ß—Ç–æ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç (—Ä—è–¥2 –∫–∞–∫ —Ä–∏—Ç—É–∞–ª—ã).
   - –ß—Ç–æ —Å–∂–∏–≥–∞–µ—Ç (—Ä—è–¥3) –∏ –∫–∞–∫ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å/–¥–æ–∑–∏—Ä–æ–≤–∞—Ç—å.
6) –í–æ–ø—Ä–æ—Å—ã –º–∞—Å—Ç–µ—Ä—É –¥–ª—è –∂–∏–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤—å—é (7‚Äì10 –≤–æ–ø—Ä–æ—Å–æ–≤), —á—Ç–æ–±—ã –¥–æ–∫–æ–ø–∞—Ç—å—Å—è –¥–æ –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–≥–æ ¬´–ø–æ—á–µ–º—É¬ª.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞):

--- –ë–ª–æ–∫ 1 ---
{b1}

--- –ë–ª–æ–∫ 2 ---
{b2}

--- –ë–ª–æ–∫ 3 ---
{b3}
"""
    return prompt.strip()


def generate_master_report(session: Dict[str, Any], table: List[List[str]]) -> str:
    client = get_openai_client()
    if client is None:
        return "‚ö†Ô∏è OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å `requirements.txt` (openai) –∏ `OPENAI_API_KEY` –≤ Secrets."

    model = get_openai_model()

    system = (
        "–¢—ã –ø–∏—à–µ—à—å –æ—Ç—á—ë—Ç –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤. "
        "–≠—Ç–æ –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∏ –Ω–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–∏–∞–≥–Ω–æ–∑. "
        "–¢–æ–Ω: —á—ë—Ç–∫–æ, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ, –±–µ–∑ –≤–æ–¥—ã."
    )
    prompt = compose_report_prompt(session, table)

    try:
        resp = client.chat.completions.create(
            model=model,
            messages=[
                {"role": "system", "content": system},
                {"role": "user", "content": prompt},
            ],
            temperature=0.6,
        )
        return resp.choices[0].message.content
    except Exception as e:
        return f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ OpenAI:\n\n{e}"


def render_master():
    st.title("Deep Identity ¬∑ –ú–∞—Å—Ç–µ—Ä-–ø–∞–Ω–µ–ª—å –ê—Å–µ–ª–∏")
    st.caption("–ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ —Ç—ã –≤–∏–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤, –∏—Ö –æ—Ç–≤–µ—Ç—ã –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –æ—Ç—á—ë—Ç—ã.")

    sessions = load_results()
    if not sessions:
        st.warning("–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ deep_identity_results.json.")
        st.info("–ï—Å–ª–∏ —ç—Ç–æ Streamlit Cloud: –≤ –æ–¥–Ω–æ–º –æ–±—â–µ–º app –≤—Å—ë –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º.")
        return

    sessions_sorted = sorted(sessions, key=lambda x: x.get("created_at", ""), reverse=True)
    labels = [format_session_title(x) for x in sessions_sorted]
    pick = st.selectbox("–í—ã–±–µ—Ä–∏ –∫–ª–∏–µ–Ω—Ç–∞", options=list(range(len(labels))), format_func=lambda i: labels[i])
    session = sessions_sorted[pick]

    st.markdown("### –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞")
    st.write(f"**–ò–º—è:** {session.get('client_name') or '‚Äî'}")
    st.write(f"**–ö–æ–Ω—Ç–∞–∫—Ç:** {session.get('client_contact') or '‚Äî'}")
    st.write(f"**–î–∞—Ç–∞:** {session.get('created_at')}")

    st.markdown("---")
    st.markdown("### –°—ã—Ä—ã–µ —Å—É–º–º—ã (–¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞)")
    combined = session.get("scores", {}).get("combined_total", {})
    if combined:
        ranked = sorted(combined.items(), key=lambda x: x[1], reverse=True)
        for k, v in ranked:
            st.write(f"- **{POT_LABEL.get(k, k)}**: {round(float(v), 2)}")

    st.markdown("---")
    st.markdown("## –¢–∞–±–ª–∏—Ü–∞ 3√ó3")
    col_scores = session.get("scores", {}).get("block3_cols", {})

    row1_def, row2_def, row3_def, table_def = build_master_table_default(combined, col_scores)

    st.markdown("### –ê–≤—Ç–æ-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä—è–¥–æ–≤ (–º–æ–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å)")
    colA, colB, colC = st.columns(3)
    with colA:
        row1 = st.multiselect("–†—è–¥ 1 (—è–¥—Ä–æ) ‚Äî –≤—ã–±–µ—Ä–∏ 3", options=POTENTIALS, default=row1_def,
                              format_func=lambda x: POT_LABEL[x], max_selections=3, key="row1")
    with colB:
        row2 = st.multiselect("–†—è–¥ 2 (–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ) ‚Äî –≤—ã–±–µ—Ä–∏ 3", options=POTENTIALS, default=row2_def,
                              format_func=lambda x: POT_LABEL[x], max_selections=3, key="row2")
    with colC:
        row3 = st.multiselect("–†—è–¥ 3 (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å) ‚Äî –≤—ã–±–µ—Ä–∏ 3", options=POTENTIALS, default=row3_def,
                              format_func=lambda x: POT_LABEL[x], max_selections=3, key="row3")

    valid = (len(row1) == 3 and len(row2) == 3 and len(row3) == 3 and len(set(row1 + row2 + row3)) == 9)
    if not valid:
        st.error("–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ 3+3+3 –∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤ (–≤ —Å—É–º–º–µ 9 —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–≤).")
        st.stop()

    table = build_3x3_table(row1, row2, row3, col_scores)
    render_3x3_table(table)

    st.markdown("---")
    st.markdown("## –û—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ (–≤–∫–ª—é—á–∞—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)")
    with st.expander("–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã"):
        st.json(session.get("answers", {}), expanded=False)

    st.markdown("---")
    st.markdown("## –ß–µ—Ä–Ω–æ–≤–æ–π –æ—Ç—á—ë—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞)")
    mr = session.get("master_report", {}) or {}
    if mr.get("draft_text"):
        st.success("–ï—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç—á—ë—Ç–∞.")
        st.text_area("–ß–µ—Ä–Ω–æ–≤–∏–∫", mr.get("draft_text", ""), height=350)
        st.download_button(
            "‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç—á—ë—Ç–∞",
            data=(mr.get("draft_text", "")).encode("utf-8"),
            file_name=f"deep_identity_report_{session.get('client_name') or 'client'}.txt",
            mime="text/plain; charset=utf-8"
        )

    if st.button("‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç—á—ë—Ç–∞ —á–µ—Ä–µ–∑ OpenAI"):
        with st.spinner("–ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç—á—ë—Ç‚Ä¶"):
            draft = generate_master_report(session, table)
        session["master_report"]["draft_text"] = draft
        session["master_report"]["generated_at"] = _now_iso()
        session["master_report"]["rows_override"] = {"row1": row1, "row2": row2, "row3": row3, "table": table}
        update_result(session)
        st.rerun()


# ============================
# –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä
# ============================

def main():
    st.set_page_config(page_title="Deep Identity", page_icon="üß†", layout="centered")
    init_state()

    st.sidebar.title("Deep Identity")
    mode = st.sidebar.radio("–†–µ–∂–∏–º", options=["–ö–ª–∏–µ–Ω—Ç", "–ú–∞—Å—Ç–µ—Ä"], index=0)
    st.session_state.mode = "master" if mode == "–ú–∞—Å—Ç–µ—Ä" else "client"

    if st.session_state.mode == "master":
        if not master_auth_ok():
            st.warning("–í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å –º–∞—Å—Ç–µ—Ä–∞ –≤ —Å–∞–π–¥–±–∞—Ä–µ.")
            return
        render_master()
        return

    # CLIENT FLOW
    if st.session_state.current_block == 0:
        render_welcome()
    elif st.session_state.current_block == 1:
        render_block1()
    elif st.session_state.current_block == 2:
        render_block2()
    elif st.session_state.current_block == 3:
        render_block3()
    else:
        render_finish_and_save()


if __name__ == "__main__":
    main()
